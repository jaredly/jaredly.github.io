<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf8"/>
<meta name="description" content="Looking into some more complex patterns in Reason+React"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="HandheldFriendly" content="True"/>
<meta name="MobileOptimized" content="320"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Advanced ReasonReact: Higher Order Components | Jared Forsyth.com"/>
<meta name="twitter:description" content="Looking into some more complex patterns in Reason+React"/>
<meta name="twitter:image" content="https://jaredforsyth.com/images/logo/JF_black_128.png"/>
<meta name="twitter:site" content="https://jaredforsyth.com"/>
<meta name="twitter:creator" content="@jaredforsyth"/>
<meta property="og:type" content="article"/>
<meta property="og:title" content="Advanced ReasonReact: Higher Order Components | Jared Forsyth.com"/>
<meta property="og:description" content="Looking into some more complex patterns in Reason+React"/>
<link rel="shortcut icon" href="/images/logo/JF_black_32.png"></link>
<title>
 
Advanced ReasonReact: Higher Order Components | Jared Forsyth.com
 
</title>
<link rel="stylesheet" href="//brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Merriweather:200,200i,400,400i,700,700i/Open+Sans:400,400i,700,700i"></link>
<link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700" rel="stylesheet"></link>
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-one-light.min.css" rel="stylesheet" media="not (prefers-color-scheme: dark)"></link>
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-vsc-dark-plus.min.css" rel="stylesheet" media="(prefers-color-scheme: dark)"></link>
<script>
if (localStorage.viewMode) {
                    document.getElementsByTagName('html')[0].className = localStorage.viewMode;
                }
                window.addEventListener('load', () => {
                    const node = document.createElement('div');
                    const dark = document.createElement('a');
                    const light = document.createElement('a');
                    dark.className = 'dark-mode-button';
                    light.className = 'light-mode-button';

                    window.setMode = (mode) => {
                        if (localStorage.viewMode === mode) {
                            localStorage.viewMode = ''
                            document.getElementsByTagName('html')[0].className = 'mode-change'

                        } else {
                            localStorage.viewMode = mode
                            document.getElementsByTagName('html')[0].className = localStorage.viewMode + ' mode-change';
                        }
                    }
                    dark.onclick = (evt) => {
                        setMode('dark-mode');
                        evt.preventDefault()
                    }
                    light.onclick = (evt) => {
                        setMode('light-mode');
                        evt.preventDefault()
                    }

                    dark.textContent = 'dark mode';
                    dark.href = 'javascript:setMode("dark-mode")'
                    light.textContent = 'light mode';
                    light.href = 'javascript:setMode("light-mode")'
                    node.appendChild(dark)
                    node.appendChild(document.createTextNode(' · '));
                    node.appendChild(light)
                    Object.assign(node.style, {
                        position: 'absolute',
                        top: '8px',
                        right: '8px',
                    });
                    document.body.appendChild(node);
                })
                
</script>
<style>

    html.mode-change {
        transition: background-color .1s ease;
    }
    html.light-mode, :root {
        
        --color-text: #333;
        --color-lightText: #999;
        --color-red: #692900;
        --color-lightOrange: #fff4ef;
        --color-darkGreen: #147429;
        --color-green: #1fad3e;
        --color-code: #ffede4;
        --color-codeText: #692900;
        background-color: white;
    
    }

    @media (prefers-color-scheme: dark) {
        :root {
            
        --color-text: #ccc;
        --color-lightText: #999;
        --color-red: #1dd442;
        --color-lightOrange: #0f0d0d;
        --color-darkGreen: #d8ac7e;
        --color-green: #ef8d27;
        --color-code: #361402;
        --color-codeText: #f9d6bf;
        background-color: #21262c;
    
        }
    }

    html.dark-mode {
        
        --color-text: #ccc;
        --color-lightText: #999;
        --color-red: #1dd442;
        --color-lightOrange: #0f0d0d;
        --color-darkGreen: #d8ac7e;
        --color-green: #ef8d27;
        --color-code: #361402;
        --color-codeText: #f9d6bf;
        background-color: #21262c;
    
    }

    main a:not([href^="/"]):not([href^="#"]):after {
        color: red;
        content: '🌐';
        font-size: 70%;
        margin-left: 4px;
    }

    .dark-mode-button, .light-mode-button {
        text-decoration: none;
        color: var(--color-text);
    }

    html.dark-mode .dark-mode-button,
    html.light-mode .light-mode-button {
        text-decoration: underline;
        color: var(--color-green);
    }

    code[class*=language-], pre[class*=language-] {
        font-size: 90% !important;
    }

    #comments p {
        font-size: 90%;
    }
    #comments p:last-child {
        padding-bottom: 0;
    }

      div {
        flex-shrink: 0;
        flex-wrap: wrap;
        box-sizing: border-box;
        min-height: 0;
        min-width: 0;
      }
      span {
        box-sizing: border-box;
      }
      code[class*=language-], pre[class*=language-],
      pre {
        margin: 0;
        margin-bottom: 1.5em;
      }
      pre {
        line-height: 18px;
        font-size: 16px;
        /* white-space: pre-wrap; */
        overflow: auto;
        max-width: 100%;
        padding: 15px;
        /* border: 1px solid #ddd; */
        font-family: Inconsolata;
        background-color: var(--color-code);
        color: var(--color-codeText);
        border-radius: 4px;
      }
      img {
        max-width: 100%;
      }
      li > code,
      a > code,
      p > code {
        font-size: 90%;
        padding: 4px;
        background-color: var(--color-code);
        color: var(--color-codeText);
        border-radius: 4px;
        hyphens: none;
      }
      blockquote {
          margin: 0;
          margin-bottom: 1em;
          padding-left: 20px;
          border-left: 5px solid var(--color-green);
          font-style: italic;
      }
      blockquote.twitter-tweet {
        font-style: normal;
        border: 1px solid var(--color-green);
        border-radius: 4px;
        padding: 8px 16px;
        font-size: 20px;
      }
      div.note {
        font-style: italic;
        flex-wrap: nowrap;
        display: flex;
        align-items: flex-start;
        font-size: 90%;
      }
      div.note::before {
        margin-right: 8px;
        content: 'i';
        border: 1px solid #ccc;
        padding: 2px 10px;
        border-radius: 50px;
        font-family: arial;
        font-style: normal;
        font-size: 20px;
        display: inline;
        line-height: 1;
        margin-top: 5px;
      }
      a {
        color: var(--color-green);
        text-decoration: none;
        /* color: #28cc4c;
        text-decoration-color: #28cc4c; */
      }
      a:hover {
        text-decoration: underline;
      }
      h1 > a, h2 > a, h3 > a, h4 > a, h5 > a, h6 > a {
        text-decoration: none;
        color: inherit;
      }
      h1 > a:hover, h2 > a:hover, h3 > a:hover, h4 > a:hover, h5 > a:hover, h6 > a:hover,
      h1 > a:focus, h2 > a:focus, h3 > a:focus, h4 > a:focus, h5 > a:focus, h6 > a:focus {
        text-decoration: underline;
        color: var(--color-green);
      }
      ul, ol {
        margin-top: 0;
      }
      .post-body h1 {
        font-family: Open sans;
      }
      h2 {
        padding-bottom: 16px;
        font-size: 32px;
        margin: 0;
        margin-top: 1em;
      }
      p {
        margin: 0;
        padding-bottom: 1em;
      }
      blockquote > p:last-child {
        padding-bottom: 0;
      }
      h3 {
        margin-bottom: 8px;
        font-family: Open sans;
        font-weight: normal;
        margin-top: 8px;
        color: #6e6e6e;
        font-size: 30px;
      }
      h5 {
        font-family: open sans;
        margin: 0;
        margin-top: 16px;
      }
      /* a:visited {
        color: #333;
      } */
      
</style>
<style>
 
.style-bb1ef180179301565afe9016b11ab16ed7413965 {
  padding: 0 16px;
  flex-shrink: 1;
  overflow: auto;
}
.style-6ae0154d10d8b0dbf4c75fa5adb959a39f9a7739 {
  text-decoration: none;
  color: inherit;
}
.style-6ae0154d10d8b0dbf4c75fa5adb959a39f9a7739:hover {
  text-decoration: underline;
}
.style-989db2448f309bfdd99b513f37c84b8f5794d2b5 {

}
.style-0044f7a33153e82f3678591650843ffdc0f020fe {
  font-size: 16px;
  margin-bottom: 16px;
  display: block;
  line-height: 20px;
  color: currentColor;
  text-decoration: none;
}
.style-0044f7a33153e82f3678591650843ffdc0f020fe:hover {
  text-decoration: underline;
}
.style-600fca2a90c30e17c2a20ea4f2f653cf60098d5b {
  color: var(--color-lightText);
  display: flex;
  flex-direction: row;
}
.style-92b92032b41d8e558573c6926aeaeeb3456b873e {
  margin-top: 100px;
  font-size: 56px;
  margin-bottom: 16px;
  padding-top: 32px;
}
@media(max-width: 600px) {
.style-92b92032b41d8e558573c6926aeaeeb3456b873e {
  font-size: 32px;
  margin-top: 40px;
}
}
@media(max-width: 600px) {
.style-92b92032b41d8e558573c6926aeaeeb3456b873e {
  margin-top: 40px;
}
}
.style-d9a01dccc38720dfd616bfebd6cb0499248e200b {
  color: var(--color-lightText);
  font-family: Open sans;
  font-size: 14px;
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: flex-start;
}
.style-fde29ab0420a52958e612784d49ff404f48528ae {
  text-decoration: none;
}
.style-cda9f9781eb5258ad50a00716278a6233b0a6313 {
  font-size: 22px;
  line-height: 40px;
  hyphens: auto;
  font-family: Merriweather;
  font-weight: 200;
}
@media(max-width: 600px) {
.style-cda9f9781eb5258ad50a00716278a6233b0a6313 {
  font-size: 20px;
  line-height: 30px;
}
}
.style-cd92fd8450a8c6641a2f0f2f0daac33e94b99b35 {
  font-family: Linux Libertine;
  color: var(--color-text);
  margin: 0;
  padding: 0;
}
.style-dc1f12ded94275ec46fa7abd837a78fd6347d5e4 {
  position: fixed;
  top: 10px;
  left: 10px;
  padding: 8px;
  background-color: black;
}
@media(min-width: 1061px) {
.style-dc1f12ded94275ec46fa7abd837a78fd6347d5e4 {
  display: none;
}
}
.style-f2140e5d177bae23c12d832734b5ce5fb0b21aa9 {
  height: 32px;
  width: 32px;
  background-size: cover;
}
.style-0da148fa6be0269fa24b9fd57a9a57aeb5297d0d {
  flex-direction: row;
  padding: 0 20px;
  display: flex;
  justify-content: center;
  align-items: stretch;
  flex-wrap: wrap;
  justify-content: flex-start;
  flex-wrap: nowrap;
}
@media(max-width: 1060px) {
.style-0da148fa6be0269fa24b9fd57a9a57aeb5297d0d {
  justify-content: center;
}
}
@media(max-width: 835px) {
.style-0da148fa6be0269fa24b9fd57a9a57aeb5297d0d {
  padding: 8px;
}
}
.style-9dc27aab0a26df3e65720efcd4de1d4b5e9e64f8 {
  background-color: var(--color-lightOrange);
  max-width: 400px;
  flex-shrink: 1;
  min-width: 300px;
  padding: 40px;
}
@media(max-width: 835px) {
.style-9dc27aab0a26df3e65720efcd4de1d4b5e9e64f8 {
  padding: 16px;
}
}
@media(max-width: 1650px) {
.style-9dc27aab0a26df3e65720efcd4de1d4b5e9e64f8 {
  padding: 20px;
}
}
@media(max-width: 1060px) {
.style-9dc27aab0a26df3e65720efcd4de1d4b5e9e64f8 {
  display: none;
}
}
.style-070d16e7de42659938f24594f2b149329d23dc29 {
  top: 40px;
}
@media(max-width: 835px) {
.style-070d16e7de42659938f24594f2b149329d23dc29 {
  top: 16px;
}
}
@media(max-width: 1650px) {
.style-070d16e7de42659938f24594f2b149329d23dc29 {
  top: 20px;
}
}
@media(min-width: 835px) {
.style-070d16e7de42659938f24594f2b149329d23dc29 {
  position: sticky;
  height: calc(100vh - 80px);
  display: flex;
  flex-wrap: nowrap;
  flex-direction: column;
}
}
.style-3ba81e27d2f8c377a36c12c6516f97660ec3facb {
  margin: 0 auto;
  width: 160px;
  overflow: hidden;
  height: 160px;
  display: block;
  border-radius: 50%;
  border: 5px solid white;
  background-color: white;
  box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3);
}
.style-1acf1679204e721558d0d3292da71a07307421a4 {
  display: block;
  width: 160px;
  height: 160px;
}
.style-0038018cf11394bd2f3cad50b7fc1d34d431f8b0 {
  text-align: center;
  font-size: 36px;
}
.style-683404bf430036582caafb930681970b717e3e38 {
  font-size: 24px;
  line-height: 36px;
  flex: 1;
  display: flex;
  flex-direction: column;
  flex-wrap: nowrap;
  text-align: left;
}
.style-da667265deef9362aecb588a818eaba3fef53068 {
  margin-bottom: 40px;
  justify-content: center;
  display: flex;
  flex-direction: row;
}
.style-da667265deef9362aecb588a818eaba3fef53068 a {
  margin: 0 8px;
}
.style-74e366023ce61639103d5fb83af3a27e33357285 {
  font-family: Open sans, sans-serif;
  font-size: 20px;
}
.style-74e366023ce61639103d5fb83af3a27e33357285 a {
  text-decoration: none;
}
.style-74e366023ce61639103d5fb83af3a27e33357285 a:hover {
  text-decoration: underline;
}
.style-ce615c601d9c9081e34880573a9c0d6582fa6737 {

}
@media(max-width: 1060px) {
.style-ce615c601d9c9081e34880573a9c0d6582fa6737 {
  display: none;
}
}
.style-cea2d442503956980c7eeb14acb78a14064ee9d4 {
  max-width: 700px;
}
@media(max-width: 1060px) {
.style-cea2d442503956980c7eeb14acb78a14064ee9d4 {
  flex-shrink: 1;
  min-width: 0;
}
}
 
</style>

                
</head>
<body class="style-cd92fd8450a8c6641a2f0f2f0daac33e94b99b35" lang="en">
<a href="/" class="style-dc1f12ded94275ec46fa7abd837a78fd6347d5e4"><div class="style-f2140e5d177bae23c12d832734b5ce5fb0b21aa9" style="background-image: url(/images/logo/JF_64.png)"></div></a>
<div class="style-0da148fa6be0269fa24b9fd57a9a57aeb5297d0d">
<div class="style-9dc27aab0a26df3e65720efcd4de1d4b5e9e64f8">
<div class="style-070d16e7de42659938f24594f2b149329d23dc29">
<a href="/" class="style-3ba81e27d2f8c377a36c12c6516f97660ec3facb"><img src="https://www.gravatar.com/avatar/313878fc8f316fc3fe4443b13913d0a4.png?s=200" alt="Jared Forsyth" class="style-1acf1679204e721558d0d3292da71a07307421a4"/></a>
<div style="height: 40px"></div>
<div class="style-0038018cf11394bd2f3cad50b7fc1d34d431f8b0">I'm Jared Forsyth</div>
<div style="height: 40px"></div>
<div class="style-683404bf430036582caafb930681970b717e3e38">
<div class="style-da667265deef9362aecb588a818eaba3fef53068">
<a href="/">home</a>
<a href="/posts/">posts</a>
<a href="/projects/">projects</a>
<a href="/talks/">talks</a>
</div>
<div class="style-bb1ef180179301565afe9016b11ab16ed7413965">
<a href="/posts/" class="style-6ae0154d10d8b0dbf4c75fa5adb959a39f9a7739"><div class="style-989db2448f309bfdd99b513f37c84b8f5794d2b5">Latest posts</div></a>
<div style="height: 8px"></div>
<a href="/posts/type-inference-that-sticks/" class="style-0044f7a33153e82f3678591650843ffdc0f020fe">
<div>
 
Type inference that sticks
 
</div>
<div class="style-600fca2a90c30e17c2a20ea4f2f653cf60098d5b">
2023
February
4
</div>
</a>
<a href="/posts/whats-cool-about-unison/" class="style-0044f7a33153e82f3678591650843ffdc0f020fe">
<div>
 
What's cool about Unison?
 
</div>
<div class="style-600fca2a90c30e17c2a20ea4f2f653cf60098d5b">
2021
March
2
</div>
</a>
<a href="/posts/local-first-database-hypermerge/" class="style-0044f7a33153e82f3678591650843ffdc0f020fe">
<div>
 
Local-first database: Hypermerge
 
</div>
<div class="style-600fca2a90c30e17c2a20ea4f2f653cf60098d5b">
2020
September
30
</div>
</a>
<a href="/posts/local-first-database-rxdb-pouchdb/" class="style-0044f7a33153e82f3678591650843ffdc0f020fe">
<div>
 
Local-first database: RxDB + PouchDB
 
</div>
<div class="style-600fca2a90c30e17c2a20ea4f2f653cf60098d5b">
2020
May
12
</div>
</a>
<a href="/posts/local-first-database-remotestorage/" class="style-0044f7a33153e82f3678591650843ffdc0f020fe">
<div>
 
Local-first database: remoteStorage.js
 
</div>
<div class="style-600fca2a90c30e17c2a20ea4f2f653cf60098d5b">
2020
May
6
</div>
</a>
<div style="height: 32px"></div>
</div>
<div style="text-align:center" class="style-74e366023ce61639103d5fb83af3a27e33357285">
<a href="https://twitter.com/jaredforsyth">twitter/@jaredforsyth</a>
<br/>
<a href="https://mastodon.social/@jaredly">@jaredly@mastodon.social</a>
<br/>
<a href="https://github.com/jaredly">github/@jaredly</a>
<br/>
<a href="/posts/rss.xml">posts rss feed</a>
</div>
</div>
</div>
</div>
<div style="flex-basis: 100px; flex-shrink: 1" class="style-ce615c601d9c9081e34880573a9c0d6582fa6737"></div>
<div class="style-cea2d442503956980c7eeb14acb78a14064ee9d4">
<main role="main">
<article>
 
<h1 class="style-92b92032b41d8e558573c6926aeaeeb3456b873e">Advanced ReasonReact: Higher Order Components</h1>
<div class="style-d9a01dccc38720dfd616bfebd6cb0499248e200b">
November
<div style="flex-basis: 4px"></div>
12,
<div style="flex-basis: 4px"></div>
2017
<div style="flex-basis: 8px"></div>
 · 
<div style="flex-basis: 8px"></div>
<a href="/tags/react/" class="style-fde29ab0420a52958e612784d49ff404f48528ae">react</a>, <div style="flex-basis: 4px"></div><a href="/tags/reason/" class="style-fde29ab0420a52958e612784d49ff404f48528ae">reason</a>
<div style="flex-basis: 8px"></div>

</div>
<div style="height: 32px"></div>
<div class="post-body style-cda9f9781eb5258ad50a00716278a6233b0a6313">
<p>After jumping into ReasonReact, I soon came to the question “How do I do higher-order components?” I had some duplicated logic in several components regarding data fetching, and I wanted to use this familiar React tool to refactor.</p>
<p>To illustrate, we’ll be making a “fetches something from the network” wrapper component. We’ll start with a “mixed component” that we’ll then try to refactor.</p>
<!-- more -->
<h2 id="An-example-mixed-component" tabindex="-1"><a class="header-anchor" href="#An-example-mixed-component">An example mixed component</a></h2>
<p>The example is a <code class="language-javascript">UserCard</code> that, given a userId, loads up &amp; displays information about that user.</p>
<pre class="language-reason"><code class="language-reason"><span class="token keyword">let</span> <span class="token keyword">module</span> <span class="token constructor">UserCard</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">type</span> state <span class="token operator">=</span>
    <span class="token operator">|</span> <span class="token constructor">Loading</span>
    <span class="token operator">|</span> <span class="token constructor">Failed</span><span class="token punctuation">(</span><span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Promise</span><span class="token punctuation">.</span>error<span class="token punctuation">)</span>
    <span class="token operator">|</span> <span class="token constructor">Loaded</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> component <span class="token operator">=</span> <span class="token class-name">ReasonReact</span><span class="token punctuation">.</span>reducerComponent<span class="token punctuation">(</span><span class="token string">"UserCard"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> make <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">~</span>greeting<span class="token punctuation">,</span> <span class="token operator">~</span>userId<span class="token punctuation">,</span> _children<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>component<span class="token punctuation">,</span>
    initialState<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constructor">Loading</span><span class="token punctuation">,</span>
    didMount<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>state<span class="token punctuation">,</span> reduce<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      fetchUser<span class="token punctuation">(</span><span class="token operator">~</span>userId<span class="token punctuation">)</span>
      <span class="token operator">|></span> <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Promise</span><span class="token punctuation">.</span>then_<span class="token punctuation">(</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token operator">=></span>  <span class="token punctuation">{</span>
        reduce<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constructor">Loaded</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Promise</span><span class="token punctuation">.</span>resolve<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">|></span> <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Promise</span><span class="token punctuation">.</span>catch<span class="token punctuation">(</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        reduce<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constructor">Failed</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Promise</span><span class="token punctuation">.</span>resolve<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">|></span> ignore
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    render<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>state<span class="token punctuation">,</span> reduce<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">switch</span> state <span class="token punctuation">{</span>
        <span class="token operator">|</span> <span class="token constructor">Loading</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">(</span>str<span class="token punctuation">(</span><span class="token string">"loading..."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token operator">|</span> <span class="token constructor">Failed</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">(</span>str<span class="token punctuation">(</span><span class="token string">"unable to load user..."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token operator">|</span> <span class="token constructor">Loaded</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>div<span class="token operator">></span>
          <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"name"</span><span class="token operator">></span>
            <span class="token punctuation">(</span>str<span class="token punctuation">(</span>greeting <span class="token operator">+</span><span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span><span class="token operator">+</span> user<span class="token operator">#</span><span class="token operator">#</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
          <span class="token operator">&lt;</span>img src<span class="token operator">=</span>user<span class="token operator">#</span><span class="token operator">#</span>profileImage className<span class="token operator">=</span><span class="token string">"profile-pic"</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Ok, so now we have a working component, but there’s a ton of plumbing involved in getting &amp; managing the state, that it would be nice to abstract away into a higher-order-component (especially if we make several of these components).</p>
<p>In JavaScript, we might do something like this</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">wrapWithFetch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fetchFromProps<span class="token punctuation">,</span> ChildComponent</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">class</span> <span class="token class-name">WrappedComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token comment">/* set up the state, make the fetch, etc. */</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>loaded<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>ChildComponent <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span> data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>data<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>And so we have people come into the #react room of our <a href="https://discord.gg/reasonml">discord channel</a> asking “how do I spread props in reason?” And the basic answer is “you can’t.”</p>
<h2 id="Why-we-can-t-spread-props" tabindex="-1"><a class="header-anchor" href="#Why-we-can-t-spread-props">Why we can’t spread props</a></h2>
<p>First let’s look at why you can spread props in JavaScript.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>ChildComponent <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span> data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>data<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token comment">// translates to</span>
React<span class="token punctuation">.</span><span class="token function">createComponent</span><span class="token punctuation">(</span>ChildComponent<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>After the JSX transformation, <code class="language-javascript">props</code> is a plain JavaScript object, and props spread becomes <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_operator#Spread_in_object_literals">object spread</a>. Reason’s JSX trasnformation &amp; corresponding API is a bit different:</p>
<pre class="language-reason"><code class="language-reason"><span class="token operator">&lt;</span><span class="token constructor">ChildComponent</span> one<span class="token operator">=</span>two three<span class="token operator">=</span>four five <span class="token operator">/</span><span class="token operator">></span>
<span class="token comment">/* translates to */</span>
<span class="token class-name">ReasonReact</span><span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token class-name">ChildComponent</span><span class="token punctuation">.</span>make<span class="token punctuation">(</span><span class="token operator">~</span>one<span class="token operator">=</span>two<span class="token punctuation">,</span> <span class="token operator">~</span>three<span class="token operator">=</span>four<span class="token punctuation">,</span> <span class="token operator">~</span>five<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">|</span><span class="token operator">|</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>Named props translate directly to named arguments on the component module’s <code class="language-javascript">make</code> function, and there’s no support in OCaml for “I have a bag of arguments please dump them into this function call”.</p>
<p>One response here is “can we change ReasonReact’s API to something more spreadable?” Even if we did, though, there’s an issue of getting the types right. Higher Order Components work in JavaScript because, in spreading the props to the child, you can “pass through” any props that the HOC doesn’t care about, but the child needs. OCaml’s type system doesn’t give us a good way to express “this component accepts any props the child does but also these other props”. (there are some dances you can do, but I haven’t found any that produces a good HOC api).</p>
<p>Fortunately, there’s another pattern that accomplishes the same thing without any type system trickery!</p>
<h2 id="Render-props" tabindex="-1"><a class="header-anchor" href="#Render-props">Render props!</a></h2>
<p>You might have heard of a fancy new technique called a “render prop”, which is what <a href="https://cdb.reacttraining.com/use-a-render-prop-50de598f11ce">the cool kids</a> are calling the “function as child” pattern.</p>
<p>In JavaScript, we could rewrite our HOC example as:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">FetcherComponent</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">fetch</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> Promise<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">,</span>
    <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token constant">T</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> React$Component<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/* set up the state, make the fetch, etc. */</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>loaded<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Here’s what it would look like in Reason</p>
<pre class="language-reason"><code class="language-reason"><span class="token keyword">let</span> <span class="token keyword">module</span> <span class="token constructor">FetcherComponent</span> <span class="token punctuation">(</span><span class="token constructor">Config</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token keyword">type</span> data<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">type</span> state <span class="token operator">=</span>
    <span class="token operator">|</span> <span class="token constructor">Loading</span>
    <span class="token operator">|</span> <span class="token constructor">Failed</span><span class="token punctuation">(</span><span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Promise</span><span class="token punctuation">.</span>error<span class="token punctuation">)</span>
    <span class="token operator">|</span> <span class="token constructor">Loaded</span><span class="token punctuation">(</span><span class="token class-name">Config</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> component <span class="token operator">=</span> <span class="token class-name">ReasonReact</span><span class="token punctuation">.</span>reducerComponent<span class="token punctuation">(</span><span class="token string">"FetcherComponent"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> make <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">~</span>fetch<span class="token punctuation">,</span> <span class="token operator">~</span>failedMessage<span class="token punctuation">,</span> <span class="token operator">~</span>render<span class="token punctuation">,</span> _children<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>component<span class="token punctuation">,</span>
    initialState<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constructor">Loading</span><span class="token punctuation">,</span>
    didMount<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>state<span class="token punctuation">,</span> reduce<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      fetch<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token operator">|></span> <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Promise</span><span class="token punctuation">.</span>then_<span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=></span>  <span class="token punctuation">{</span>
        reduce<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constructor">Loaded</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Promise</span><span class="token punctuation">.</span>resolve<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">|></span> <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Promise</span><span class="token punctuation">.</span>catch<span class="token punctuation">(</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        reduce<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constructor">Failed</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Promise</span><span class="token punctuation">.</span>resolve<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">|></span> ignore
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    render<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>state<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">switch</span> state <span class="token punctuation">{</span>
        <span class="token operator">|</span> <span class="token constructor">Loading</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">(</span>str<span class="token punctuation">(</span><span class="token string">"loading..."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token operator">|</span> <span class="token constructor">Failed</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">(</span>str<span class="token punctuation">(</span>failedMessage<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token operator">|</span> <span class="token constructor">Loaded</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=></span> render<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>And then we could use it like this:</p>
<pre class="language-reason"><code class="language-reason"><span class="token keyword">let</span> <span class="token keyword">module</span> <span class="token constructor">UserFetcher</span> <span class="token operator">=</span> <span class="token constructor">FetcherComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token keyword">type</span> data <span class="token operator">=</span> user<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token keyword">module</span> <span class="token constructor">UserCard</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> make <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">~</span>greeting<span class="token punctuation">,</span> <span class="token operator">~</span>userId<span class="token punctuation">,</span> _children<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token class-name">UserFetcher</span><span class="token punctuation">.</span>make<span class="token punctuation">(</span>
      <span class="token operator">~</span>fetch<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> fetchUser<span class="token punctuation">(</span><span class="token operator">~</span>userId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token operator">~</span>failedMessage<span class="token operator">=</span><span class="token string">"Unable to load user"</span><span class="token punctuation">,</span>
      <span class="token operator">~</span>render<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token operator">&lt;</span>div<span class="token operator">></span>
          <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"name"</span><span class="token operator">></span>
            <span class="token punctuation">(</span>str<span class="token punctuation">(</span>greeting <span class="token operator">+</span><span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span><span class="token operator">+</span> user<span class="token operator">#</span><span class="token operator">#</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
          <span class="token operator">&lt;</span>img src<span class="token operator">=</span>user<span class="token operator">#</span><span class="token operator">#</span>profileImage className<span class="token operator">=</span><span class="token string">"profile-pic"</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span><span class="token operator">|</span><span class="token operator">|</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/* somewhere */</span>
<span class="token operator">&lt;</span><span class="token constructor">UserCard</span> greeting<span class="token operator">=</span><span class="token string">"Howdy"</span> userId<span class="token operator">=</span><span class="token string">"root"</span> <span class="token operator">/</span><span class="token operator">></span>
</code></pre>
<p>There are a couple of interesting things going on here.</p>
<p>First, we’re using a parameterized module (in OCaml called a “functor”) so that our <code class="language-javascript">FetcherComponent</code> can know what type of thing it’s loading. (We <em>might</em> have been able to get away with relying on inference by using Variants, but this way the error messages will be much nicer.)</p>
<p>Second, there is no <code class="language-javascript">UserCard</code> component! Our <code class="language-javascript">UserCard</code> module’s <code class="language-javascript">make</code> function just instantiates a <code class="language-javascript">UserFetcher</code> component after doing a transformation on the props. This render-prop pattern is just one of the cool things you can do with this setup 🙂.</p>
<p>And at the end of it, we’ve separated out the plumbing of “dealing with async” from the things that were actually unique to our UserCard component. I consider that success!</p>
<h2 id="More-examples" tabindex="-1"><a class="header-anchor" href="#More-examples">More examples</a></h2>
<p>I extracted this pattern from a <a href="https://github.com/jaredly/f3d">web app I’m working on</a>, and you can browse around for some real-code examples:</p>
<ul>
<li>Some generic “Fetcher” components (<a href="https://github.com/jaredly/f3d/blob/818760290ae6f0ee243a9f405d2d313d32161dd3/packages/bs-firebase-react/src/FirebaseFetcher.re">code</a>)</li>
<li>A simple example of using a fetcher (<a href="https://github.com/jaredly/f3d/blob/3f7642312a18f5699be25987f030f75c4df63607/src/Recipe/UserName.re">code</a>)</li>
<li>Using two Fetchers together (<a href="https://github.com/jaredly/f3d/blob/3f7642312a18f5699be25987f030f75c4df63607/src/Recipe/ViewRecipe.re#L234">code</a>)</li>
<li>Combining a Fetcher with a curried function (<a href="https://github.com/jaredly/f3d/blob/3f7642312a18f5699be25987f030f75c4df63607/src/Recipe/ViewMadeIts.re#L11">code</a>)</li>
</ul>
<p>Let me know <a href="https://twitter.com/jaredforsyth">on twitter</a> or <a href="https://discord.gg/reasonml">discord</a> if this was helpful or you have questions!</p>

</div>

 
</article>
</main>
<div style="height: 128px"></div>
</div>
<div style="flex-basis: 100px; flex-shrink: 1" class="style-ce615c601d9c9081e34880573a9c0d6582fa6737"></div>
</div>
</body>
</html>