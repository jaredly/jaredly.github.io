<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf8"/>
<meta name="description" content="How to communicate safely and unsafely with the host language."/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="HandheldFriendly" content="True"/>
<meta name="MobileOptimized" content="320"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="JavaScript Interop with Reason and BuckleScript | Jared Forsyth.com"/>
<meta name="twitter:description" content="How to communicate safely and unsafely with the host language."/>
<meta name="twitter:image" content="https://jaredforsyth.com/images/logo/JF_black_128.png"/>
<meta name="twitter:site" content="https://jaredforsyth.com"/>
<meta name="twitter:creator" content="@jaredforsyth"/>
<meta property="og:type" content="article"/>
<meta property="og:title" content="JavaScript Interop with Reason and BuckleScript | Jared Forsyth.com"/>
<meta property="og:description" content="How to communicate safely and unsafely with the host language."/>
<link rel="shortcut icon" href="/images/logo/JF_black_32.png"></link>
<title>
 
JavaScript Interop with Reason and BuckleScript | Jared Forsyth.com
 
</title>
<link rel="stylesheet" href="//brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Merriweather:200,200i,400,400i,700,700i/Open+Sans:400,400i,700,700i"></link>
<link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700" rel="stylesheet"></link>
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-one-light.min.css" rel="stylesheet" media="not (prefers-color-scheme: dark)"></link>
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-vsc-dark-plus.min.css" rel="stylesheet" media="(prefers-color-scheme: dark)"></link>
<script>
if (localStorage.viewMode) {
                    document.getElementsByTagName('html')[0].className = localStorage.viewMode;
                }
                window.addEventListener('load', () => {
                    const node = document.createElement('div');
                    const dark = document.createElement('a');
                    const light = document.createElement('a');
                    dark.className = 'dark-mode-button';
                    light.className = 'light-mode-button';

                    window.setMode = (mode) => {
                        if (localStorage.viewMode === mode) {
                            localStorage.viewMode = ''
                            document.getElementsByTagName('html')[0].className = 'mode-change'

                        } else {
                            localStorage.viewMode = mode
                            document.getElementsByTagName('html')[0].className = localStorage.viewMode + ' mode-change';
                        }
                    }
                    dark.onclick = (evt) => {
                        setMode('dark-mode');
                        evt.preventDefault()
                    }
                    light.onclick = (evt) => {
                        setMode('light-mode');
                        evt.preventDefault()
                    }

                    dark.textContent = 'dark mode';
                    dark.href = 'javascript:setMode("dark-mode")'
                    light.textContent = 'light mode';
                    light.href = 'javascript:setMode("light-mode")'
                    node.appendChild(dark)
                    node.appendChild(document.createTextNode(' ¬∑ '));
                    node.appendChild(light)
                    Object.assign(node.style, {
                        position: 'absolute',
                        top: '8px',
                        right: '8px',
                    });
                    document.body.appendChild(node);
                })
                
</script>
<style>

    html.mode-change {
        transition: background-color .1s ease;
    }
    html.light-mode, :root {
        
        --color-text: #333;
        --color-lightText: #999;
        --color-red: #692900;
        --color-lightOrange: #fff4ef;
        --color-darkGreen: #147429;
        --color-green: #1fad3e;
        --color-code: #ffede4;
        --color-codeText: #692900;
        background-color: white;
    
    }

    @media (prefers-color-scheme: dark) {
        :root {
            
        --color-text: #ccc;
        --color-lightText: #999;
        --color-red: #1dd442;
        --color-lightOrange: #0f0d0d;
        --color-darkGreen: #d8ac7e;
        --color-green: #ef8d27;
        --color-code: #361402;
        --color-codeText: #f9d6bf;
        background-color: #21262c;
    
        }
    }

    html.dark-mode {
        
        --color-text: #ccc;
        --color-lightText: #999;
        --color-red: #1dd442;
        --color-lightOrange: #0f0d0d;
        --color-darkGreen: #d8ac7e;
        --color-green: #ef8d27;
        --color-code: #361402;
        --color-codeText: #f9d6bf;
        background-color: #21262c;
    
    }

    main a:not([href^="/"]):not([href^="#"]):after {
        color: red;
        content: 'üåê';
        font-size: 70%;
        margin-left: 4px;
    }

    .dark-mode-button, .light-mode-button {
        text-decoration: none;
        color: var(--color-text);
    }

    html.dark-mode .dark-mode-button,
    html.light-mode .light-mode-button {
        text-decoration: underline;
        color: var(--color-green);
    }

    code[class*=language-], pre[class*=language-] {
        font-size: 90% !important;
    }

    #comments p {
        font-size: 90%;
    }
    #comments p:last-child {
        padding-bottom: 0;
    }
    #hn p {
        font-size: 60%;
        line-height: 1.8em;
    }
    #hn p:last-child {
        padding-bottom: 0;
    }

      div {
        flex-shrink: 0;
        flex-wrap: wrap;
        box-sizing: border-box;
        min-height: 0;
        min-width: 0;
      }
      span {
        box-sizing: border-box;
      }
      code[class*=language-], pre[class*=language-],
      pre {
        margin: 0;
        margin-bottom: 1.5em;
      }
      pre {
        line-height: 18px;
        font-size: 16px;
        /* white-space: pre-wrap; */
        overflow: auto;
        max-width: 100%;
        padding: 15px;
        /* border: 1px solid #ddd; */
        font-family: Inconsolata;
        background-color: var(--color-code);
        color: var(--color-codeText);
        border-radius: 4px;
      }
      img {
        max-width: 100%;
      }
      li > code,
      a > code,
      p > code {
        font-size: 90%;
        padding: 4px;
        background-color: var(--color-code);
        color: var(--color-codeText);
        border-radius: 4px;
        hyphens: none;
      }
      blockquote {
          margin: 0;
          margin-bottom: 1em;
          padding-left: 20px;
          border-left: 5px solid var(--color-green);
          font-style: italic;
      }
      blockquote.twitter-tweet {
        font-style: normal;
        border: 1px solid var(--color-green);
        border-radius: 4px;
        padding: 8px 16px;
        font-size: 20px;
      }
      div.note {
        font-style: italic;
        flex-wrap: nowrap;
        display: flex;
        align-items: flex-start;
        font-size: 90%;
      }
      div.note::before {
        margin-right: 8px;
        content: 'i';
        border: 1px solid #ccc;
        padding: 2px 10px;
        border-radius: 50px;
        font-family: arial;
        font-style: normal;
        font-size: 20px;
        display: inline;
        line-height: 1;
        margin-top: 5px;
      }
      a {
        color: var(--color-green);
        text-decoration: none;
        /* color: #28cc4c;
        text-decoration-color: #28cc4c; */
      }
      a:hover {
        text-decoration: underline;
      }
      h1 > a, h2 > a, h3 > a, h4 > a, h5 > a, h6 > a {
        text-decoration: none;
        color: inherit;
      }
      h1 > a:hover, h2 > a:hover, h3 > a:hover, h4 > a:hover, h5 > a:hover, h6 > a:hover,
      h1 > a:focus, h2 > a:focus, h3 > a:focus, h4 > a:focus, h5 > a:focus, h6 > a:focus {
        text-decoration: underline;
        color: var(--color-green);
      }
      ul, ol {
        margin-top: 0;
      }
      .post-body h1 {
        font-family: Open sans;
      }
      h2 {
        padding-bottom: 16px;
        font-size: 32px;
        margin: 0;
        margin-top: 1em;
      }
      p {
        margin: 0;
        padding-bottom: 1em;
      }
      blockquote > p:last-child {
        padding-bottom: 0;
      }
      h3 {
        margin-bottom: 8px;
        font-family: Open sans;
        font-weight: normal;
        margin-top: 8px;
        color: #6e6e6e;
        font-size: 30px;
      }
      h5 {
        font-family: open sans;
        margin: 0;
        margin-top: 16px;
      }
      /* a:visited {
        color: #333;
      } */
      
</style>
<style>
 
.style-bb1ef180179301565afe9016b11ab16ed7413965 {
  padding: 0 16px;
  flex-shrink: 1;
  overflow: auto;
}
.style-6ae0154d10d8b0dbf4c75fa5adb959a39f9a7739 {
  text-decoration: none;
  color: inherit;
}
.style-6ae0154d10d8b0dbf4c75fa5adb959a39f9a7739:hover {
  text-decoration: underline;
}
.style-989db2448f309bfdd99b513f37c84b8f5794d2b5 {

}
.style-0044f7a33153e82f3678591650843ffdc0f020fe {
  font-size: 16px;
  margin-bottom: 16px;
  display: block;
  line-height: 20px;
  color: currentColor;
  text-decoration: none;
}
.style-0044f7a33153e82f3678591650843ffdc0f020fe:hover {
  text-decoration: underline;
}
.style-600fca2a90c30e17c2a20ea4f2f653cf60098d5b {
  color: var(--color-lightText);
  display: flex;
  flex-direction: row;
}
.style-92b92032b41d8e558573c6926aeaeeb3456b873e {
  margin-top: 100px;
  font-size: 56px;
  margin-bottom: 16px;
  padding-top: 32px;
}
@media(max-width: 600px) {
.style-92b92032b41d8e558573c6926aeaeeb3456b873e {
  font-size: 32px;
  margin-top: 40px;
}
}
@media(max-width: 600px) {
.style-92b92032b41d8e558573c6926aeaeeb3456b873e {
  margin-top: 40px;
}
}
.style-d9a01dccc38720dfd616bfebd6cb0499248e200b {
  color: var(--color-lightText);
  font-family: Open sans;
  font-size: 14px;
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: flex-start;
}
.style-fde29ab0420a52958e612784d49ff404f48528ae {
  text-decoration: none;
}
.style-cda9f9781eb5258ad50a00716278a6233b0a6313 {
  font-size: 22px;
  line-height: 40px;
  hyphens: auto;
  font-family: Merriweather;
  font-weight: 200;
}
@media(max-width: 600px) {
.style-cda9f9781eb5258ad50a00716278a6233b0a6313 {
  font-size: 20px;
  line-height: 30px;
}
}
.style-cd92fd8450a8c6641a2f0f2f0daac33e94b99b35 {
  font-family: Linux Libertine;
  color: var(--color-text);
  margin: 0;
  padding: 0;
}
.style-dc1f12ded94275ec46fa7abd837a78fd6347d5e4 {
  position: fixed;
  top: 10px;
  left: 10px;
  padding: 8px;
  background-color: black;
}
@media(min-width: 1061px) {
.style-dc1f12ded94275ec46fa7abd837a78fd6347d5e4 {
  display: none;
}
}
.style-f2140e5d177bae23c12d832734b5ce5fb0b21aa9 {
  height: 32px;
  width: 32px;
  background-size: cover;
}
.style-0da148fa6be0269fa24b9fd57a9a57aeb5297d0d {
  flex-direction: row;
  padding: 0 20px;
  display: flex;
  justify-content: center;
  align-items: stretch;
  flex-wrap: wrap;
  justify-content: flex-start;
  flex-wrap: nowrap;
}
@media(max-width: 1060px) {
.style-0da148fa6be0269fa24b9fd57a9a57aeb5297d0d {
  justify-content: center;
}
}
@media(max-width: 835px) {
.style-0da148fa6be0269fa24b9fd57a9a57aeb5297d0d {
  padding: 8px;
}
}
.style-9dc27aab0a26df3e65720efcd4de1d4b5e9e64f8 {
  background-color: var(--color-lightOrange);
  max-width: 400px;
  flex-shrink: 1;
  min-width: 300px;
  padding: 40px;
}
@media(max-width: 835px) {
.style-9dc27aab0a26df3e65720efcd4de1d4b5e9e64f8 {
  padding: 16px;
}
}
@media(max-width: 1650px) {
.style-9dc27aab0a26df3e65720efcd4de1d4b5e9e64f8 {
  padding: 20px;
}
}
@media(max-width: 1060px) {
.style-9dc27aab0a26df3e65720efcd4de1d4b5e9e64f8 {
  display: none;
}
}
.style-070d16e7de42659938f24594f2b149329d23dc29 {
  top: 40px;
}
@media(max-width: 835px) {
.style-070d16e7de42659938f24594f2b149329d23dc29 {
  top: 16px;
}
}
@media(max-width: 1650px) {
.style-070d16e7de42659938f24594f2b149329d23dc29 {
  top: 20px;
}
}
@media(min-width: 835px) {
.style-070d16e7de42659938f24594f2b149329d23dc29 {
  position: sticky;
  height: calc(100vh - 80px);
  display: flex;
  flex-wrap: nowrap;
  flex-direction: column;
}
}
.style-3ba81e27d2f8c377a36c12c6516f97660ec3facb {
  margin: 0 auto;
  width: 160px;
  overflow: hidden;
  height: 160px;
  display: block;
  border-radius: 50%;
  border: 5px solid white;
  background-color: white;
  box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3);
}
.style-1acf1679204e721558d0d3292da71a07307421a4 {
  display: block;
  width: 160px;
  height: 160px;
}
.style-0038018cf11394bd2f3cad50b7fc1d34d431f8b0 {
  text-align: center;
  font-size: 36px;
}
.style-683404bf430036582caafb930681970b717e3e38 {
  font-size: 24px;
  line-height: 36px;
  flex: 1;
  display: flex;
  flex-direction: column;
  flex-wrap: nowrap;
  text-align: left;
}
.style-da667265deef9362aecb588a818eaba3fef53068 {
  margin-bottom: 40px;
  justify-content: center;
  display: flex;
  flex-direction: row;
}
.style-da667265deef9362aecb588a818eaba3fef53068 a {
  margin: 0 8px;
}
.style-74e366023ce61639103d5fb83af3a27e33357285 {
  font-family: Open sans, sans-serif;
  font-size: 20px;
}
.style-74e366023ce61639103d5fb83af3a27e33357285 a {
  text-decoration: none;
}
.style-74e366023ce61639103d5fb83af3a27e33357285 a:hover {
  text-decoration: underline;
}
.style-ce615c601d9c9081e34880573a9c0d6582fa6737 {

}
@media(max-width: 1060px) {
.style-ce615c601d9c9081e34880573a9c0d6582fa6737 {
  display: none;
}
}
.style-cea2d442503956980c7eeb14acb78a14064ee9d4 {
  max-width: 700px;
}
@media(max-width: 1060px) {
.style-cea2d442503956980c7eeb14acb78a14064ee9d4 {
  flex-shrink: 1;
  min-width: 0;
}
}
 
</style>

                
</head>
<body class="style-cd92fd8450a8c6641a2f0f2f0daac33e94b99b35" lang="en">
<a href="/" class="style-dc1f12ded94275ec46fa7abd837a78fd6347d5e4"><div class="style-f2140e5d177bae23c12d832734b5ce5fb0b21aa9" style="background-image: url(/images/logo/JF_64.png)"></div></a>
<div class="style-0da148fa6be0269fa24b9fd57a9a57aeb5297d0d">
<div class="style-9dc27aab0a26df3e65720efcd4de1d4b5e9e64f8">
<div class="style-070d16e7de42659938f24594f2b149329d23dc29">
<a href="/" class="style-3ba81e27d2f8c377a36c12c6516f97660ec3facb"><img src="https://www.gravatar.com/avatar/313878fc8f316fc3fe4443b13913d0a4.png?s=200" alt="Jared Forsyth" class="style-1acf1679204e721558d0d3292da71a07307421a4"/></a>
<div style="height: 40px"></div>
<div class="style-0038018cf11394bd2f3cad50b7fc1d34d431f8b0">I'm Jared Forsyth</div>
<div style="height: 40px"></div>
<div class="style-683404bf430036582caafb930681970b717e3e38">
<div class="style-da667265deef9362aecb588a818eaba3fef53068">
<a href="/">home</a>
<a href="/posts/">posts</a>
<a href="/projects/">projects</a>
<a href="/talks/">talks</a>
</div>
<div class="style-bb1ef180179301565afe9016b11ab16ed7413965">
<a href="/posts/" class="style-6ae0154d10d8b0dbf4c75fa5adb959a39f9a7739"><div class="style-989db2448f309bfdd99b513f37c84b8f5794d2b5">Latest posts</div></a>
<div style="height: 8px"></div>
<a href="/posts/type-inference-that-sticks/" class="style-0044f7a33153e82f3678591650843ffdc0f020fe">
<div>
 
Type inference that sticks
 
</div>
<div class="style-600fca2a90c30e17c2a20ea4f2f653cf60098d5b">
2023
February
4
</div>
</a>
<a href="/posts/whats-cool-about-unison/" class="style-0044f7a33153e82f3678591650843ffdc0f020fe">
<div>
 
What's cool about Unison?
 
</div>
<div class="style-600fca2a90c30e17c2a20ea4f2f653cf60098d5b">
2021
March
2
</div>
</a>
<a href="/posts/local-first-database-hypermerge/" class="style-0044f7a33153e82f3678591650843ffdc0f020fe">
<div>
 
Local-first database: Hypermerge
 
</div>
<div class="style-600fca2a90c30e17c2a20ea4f2f653cf60098d5b">
2020
September
30
</div>
</a>
<a href="/posts/local-first-database-rxdb-pouchdb/" class="style-0044f7a33153e82f3678591650843ffdc0f020fe">
<div>
 
Local-first database: RxDB + PouchDB
 
</div>
<div class="style-600fca2a90c30e17c2a20ea4f2f653cf60098d5b">
2020
May
12
</div>
</a>
<a href="/posts/local-first-database-remotestorage/" class="style-0044f7a33153e82f3678591650843ffdc0f020fe">
<div>
 
Local-first database: remoteStorage.js
 
</div>
<div class="style-600fca2a90c30e17c2a20ea4f2f653cf60098d5b">
2020
May
6
</div>
</a>
<div style="height: 32px"></div>
</div>
<div style="text-align:center" class="style-74e366023ce61639103d5fb83af3a27e33357285">
<a href="https://twitter.com/jaredforsyth">twitter/@jaredforsyth</a>
<br/>
<a href="https://mastodon.social/@jaredly">@jaredly@mastodon.social</a>
<br/>
<a href="https://github.com/jaredly">github/@jaredly</a>
<br/>
<a href="/posts/rss.xml">posts rss feed</a>
</div>
</div>
</div>
</div>
<div style="flex-basis: 100px; flex-shrink: 1" class="style-ce615c601d9c9081e34880573a9c0d6582fa6737"></div>
<div class="style-cea2d442503956980c7eeb14acb78a14064ee9d4">
<main role="main">
<article>
 
<h1 class="style-92b92032b41d8e558573c6926aeaeeb3456b873e">JavaScript Interop with Reason and BuckleScript</h1>
<div class="style-d9a01dccc38720dfd616bfebd6cb0499248e200b">
June
<div style="flex-basis: 4px"></div>
3,
<div style="flex-basis: 4px"></div>
2017
<div style="flex-basis: 8px"></div>
 ¬∑ 
<div style="flex-basis: 8px"></div>
<a href="/tags/tutorial/" class="style-fde29ab0420a52958e612784d49ff404f48528ae">tutorial</a>, <div style="flex-basis: 4px"></div><a href="/tags/ocaml/" class="style-fde29ab0420a52958e612784d49ff404f48528ae">ocaml</a>, <div style="flex-basis: 4px"></div><a href="/tags/reason/" class="style-fde29ab0420a52958e612784d49ff404f48528ae">reason</a>, <div style="flex-basis: 4px"></div><a href="/tags/javascript/" class="style-fde29ab0420a52958e612784d49ff404f48528ae">javascript</a>
<div style="flex-basis: 8px"></div>

</div>
<div style="height: 32px"></div>
<div class="post-body style-cda9f9781eb5258ad50a00716278a6233b0a6313">
<p>So you‚Äôre all ready to write some Reason but you need to call a JavaScript function? Or maybe you can‚Äôt figure out how to write something in OCaml-land and wish you could just bail for a minute &amp; write it in JavaScript? Fortunately, both of those are fairly easy to pull off.</p>
<!-- more -->
<p>If you don‚Äôt already have Reason + BuckleScript set up on your machine, head over to the <a href="http://jaredforsyth.com/2017/06/03/getting-started-with-reason-and-bucklescript/">‚ÄúGetting Started‚Äù blog post</a> or clone <a href="https://github.com/jaredly/reason-bucklescript-example">this github repository</a> for a minimal boilerplate. If you want a primer on Reason syntax, the <a href="http://facebook.github.io/reason/">Reason documentation</a> provides a nice comparison to JavaScript.</p>
<blockquote>
<p>I‚Äôll be using Reason syntax instead of standard OCaml syntax because I like it much better :) but all of the stuff here applies to vanilla OCaml + Bucklescript as well, and the syntax is quite similar. The latest version of Bucklescript as of this writing is 1.7.4, so if yours is later than that, some details might be different. In all of this, you can consult the excellent <a href="http://bucklescript.github.io/bucklescript/Manual.html">Bucklescript documentation</a>.</p>
</blockquote>
<h2 id="Just-dumping-JavaScript-in-the-middle-of-your-Reason-code" tabindex="-1"><a class="header-anchor" href="#Just-dumping-JavaScript-in-the-middle-of-your-Reason-code">Just dumping JavaScript in the middle of your Reason code</a></h2>
<p>If you‚Äôre just hacking things together, this can be very nice, but you also have all of the unsafety of JavaScript code üòÑ.</p>
<pre class="language-ocaml"><code class="language-ocaml">Js<span class="token punctuation">.</span>log <span class="token string">"this is reason"</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token operator">%%</span>bs<span class="token punctuation">.</span>raw <span class="token string">{|
console.log('here is some javascript for you');
|}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>
<blockquote>
<p><code class="language-javascript"><span class="token punctuation">{</span><span class="token operator">|</span></code> and <code class="language-javascript"><span class="token operator">|</span><span class="token punctuation">}</span></code> are the delimeters of a multi-line string in OCaml. You can also put a tag in there e.g. <code class="language-javascript"><span class="token punctuation">{</span>something<span class="token operator">|</span></code> and then it will look for a matching <code class="language-javascript"><span class="token operator">|</span>something<span class="token punctuation">}</span></code> to close.</p>
</blockquote>
<p>And here‚Äôs the resulting javascript:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// Generated by BUCKLESCRIPT VERSION 1.7.4, PLEASE EDIT WITH CARE</span>
<span class="token string">'use strict'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"this is reason"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'here is some javascript for you'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="Dumping-in-some-JavaScript-and-making-it-accessible-from-Reason" tabindex="-1"><a class="header-anchor" href="#Dumping-in-some-JavaScript-and-making-it-accessible-from-Reason">Dumping in some JavaScript, and making it accessible from Reason</a></h2>
<p>What if you want a value that can be used from your Reason code?</p>
<pre class="language-ocaml"><code class="language-ocaml">Js<span class="token punctuation">.</span>log <span class="token string">"this is reason"</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">%</span>bs<span class="token punctuation">.</span>raw <span class="token string">{| 'here is a string from javascript' |}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
Js<span class="token punctuation">.</span>log <span class="token punctuation">(</span>x <span class="token operator">^</span> <span class="token string">" back in reason land"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">/*</span> <span class="token operator">^</span> is the operator <span class="token keyword">for</span> string concat <span class="token operator">*/</span>
</code></pre>
<p>Now you might be wondering &quot;what magic is this?? How did ocaml know that <code class="language-javascript">x</code> was a string? <strong>It doesn‚Äôt</strong>. The type of <code class="language-javascript">x</code> in this code is a magic type that will unify with anything! This is quite dangerous and can have cascading effects in OCaml‚Äôs type inference algorithm.</p>
<pre class="language-ocaml"><code class="language-ocaml"><span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">%</span>bs<span class="token punctuation">.</span>raw <span class="token string">{| 'something' |}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
Js<span class="token punctuation">.</span>log <span class="token punctuation">(</span><span class="token string">"a string"</span> <span class="token operator">^</span> y<span class="token punctuation">,</span> <span class="token number">10</span> <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">/*</span> danger<span class="token operator">!!</span> ocaml won't stop you from using y <span class="token keyword">as</span> <span class="token number">2</span> totally different types <span class="token operator">*/</span>
</code></pre>
<p>To fix this, you should <strong>always</strong> provide a concrete type for the result of <code class="language-javascript">bs<span class="token punctuation">.</span>raw</code>.</p>
<pre class="language-ocaml"><code class="language-ocaml"><span class="token keyword">let</span> x<span class="token punctuation">:</span> string <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">%</span>bs<span class="token punctuation">.</span>raw <span class="token string">{| 'well-typed' |}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
Js<span class="token punctuation">.</span>log <span class="token punctuation">(</span>x <span class="token operator">^</span> <span class="token string">" back in reason land"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">/*</span> ocaml will error out <span class="token keyword">if</span> you <span class="token keyword">try</span> <span class="token keyword">to</span> use x <span class="token keyword">as</span> anything other than a string <span class="token operator">*/</span>
</code></pre>
<p>And here‚Äôs the output!</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// Generated by BUCKLESCRIPT VERSION 1.7.4, PLEASE EDIT WITH CARE</span>
<span class="token string">'use strict'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"this is reason"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token string">'here is a string from javascript'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token string">" back in reason land"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token string">'something'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token comment">/* tuple */</span><span class="token punctuation">[</span>
      <span class="token string">"a string"</span> <span class="token operator">+</span> y<span class="token punctuation">,</span>
      <span class="token number">10</span> <span class="token operator">+</span> y <span class="token operator">|</span> <span class="token number">0</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> x$1 <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token string">'well-typed'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x$1 <span class="token operator">+</span> <span class="token string">" back in reason land"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<blockquote>
<p>The difference between the 2 <code class="language-javascript"><span class="token operator">%</span><span class="token operator">%</span></code> from the previous section and the 1 <code class="language-javascript"><span class="token operator">%</span></code> here is important! <code class="language-javascript"><span class="token punctuation">[</span><span class="token operator">%</span><span class="token operator">%</span>something <span class="token operator">...</span><span class="token punctuation">]</span></code> is an OCaml ‚Äúextension point‚Äù that represents a <em>top-level</em> statement (it can‚Äôt show up inside a function or value, for example). <code class="language-javascript"><span class="token punctuation">[</span><span class="token operator">%</span>something <span class="token operator">...</span><span class="token punctuation">]</span></code> is an extension point that stands in for an <em>expression</em>, and can be put just about anywhere ‚Äì but make sure that the JavaScript you put inside is actually an expression! E.g. don‚Äôt put a semicolon after it, or you‚Äôll get a syntax error when you try to run the resulting JavaScript.</p>
</blockquote>
<h2 id="Dumping-in-a-function-passing-values" tabindex="-1"><a class="header-anchor" href="#Dumping-in-a-function-passing-values">Dumping in a function &amp; passing values</a></h2>
<p>We‚Äôll need a little knowledge about Bucklescript‚Äôs runtime representation of various values for this to work.</p>
<ul>
<li><code class="language-javascript">strings</code> are strings, <code class="language-javascript">ints</code> and <code class="language-javascript">floats</code> are just numbers</li>
<li>an <a href="http://facebook.github.io/reason/#built-in-data-types-array">Array</a> is a mutable fixed-length list in OCaml, and is represented as a plain javascript array.</li>
<li>a <a href="http://facebook.github.io/reason/#built-in-data-types-linked-list">List</a> is an immutable functional-style linked list, and is definitely the more idiomatic one to use in most cases. However, it‚Äôs representation is more complicated (try <code class="language-javascript">Js<span class="token punctuation">.</span>log <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span></code> to check it out). Because of this, I generally convert to &amp; from <code class="language-javascript">Array</code>s when I‚Äôm talking to javascript, via <code class="language-javascript">Array<span class="token punctuation">.</span>of_list</code> and <code class="language-javascript">Array<span class="token punctuation">.</span>to_list</code>.</li>
<li>If you want to go deeper, there‚Äôs an exhaustive list <a href="https://github.com/bucklescript/bucklescript/wiki/Runtime-representation">on the BuckleScript wiki</a></li>
</ul>
<p>Knowing that, we can write a function in JavaScript that just accepts an array and returns a number, without much trouble at all.</p>
<pre class="language-ocaml"><code class="language-ocaml"><span class="token keyword">let</span> jsCalculate<span class="token punctuation">:</span> array int <span class="token operator">=></span> int <span class="token operator">=></span> int <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">%</span>bs<span class="token punctuation">.</span>raw <span class="token string">{|
 function (numbers, scaleFactor) {
   var result = 0;
   numbers.forEach(number => {
     result += number;
   });
   return result * scaleFactor;
 }
|}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> calculate numbers scaleFactor <span class="token operator">=></span>
  jsCalculate <span class="token punctuation">(</span>Array<span class="token punctuation">.</span>of_list numbers<span class="token punctuation">)</span> scaleFactor<span class="token punctuation">;</span>
Js<span class="token punctuation">.</span>log <span class="token punctuation">(</span>calculate <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">/*</span> <span class="token operator">-></span> <span class="token number">60</span> <span class="token operator">*/</span>
</code></pre>
<p>Of course, this function that I wrote in JavaScript could be ported over to Reason without much hassle.</p>
<p><strong>Remember</strong> that this is an escape hatch that‚Äôs very useful for learning so you can jump in quickly and make something, but it‚Äôs a good exercise to go back through and convert things back into nice type safe reason code.</p>
<p>I‚Äôve run into more than a few bugs because of raw JavaScript that I added to save time üòÖ.</p>
<h2 id="Settling-down-and-getting-disciplined-about-things" tabindex="-1"><a class="header-anchor" href="#Settling-down-and-getting-disciplined-about-things">Settling down and getting disciplined about things</a></h2>
<p>So far we‚Äôve been using <code class="language-javascript">bs<span class="token punctuation">.</span>raw</code>, which is a very fast n loose way to do it, and <strong>not</strong> suitable for production.</p>
<p>But what if we actually need to call a function that‚Äôs in JavaScript? It‚Äôs needed for interacting with the DOM, or using node modules. In BuckleScript, you use an <code class="language-javascript">external</code> declaration (<a href="http://bucklescript.github.io/bucklescript/Manual.html#_binding_to_simple_js_functions_values">docs</a>).</p>
<p>Getting a value and getting a function are both pretty easy:</p>
<pre class="language-ocaml"><code class="language-ocaml"><span class="token keyword">external</span> pi<span class="token punctuation">:</span> float <span class="token operator">=</span> <span class="token string">"Math.PI"</span> <span class="token punctuation">[</span><span class="token operator">@@</span>bs<span class="token punctuation">.</span><span class="token keyword">val</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> tau <span class="token operator">=</span> pi <span class="token operator">*.</span> <span class="token number">2.0</span><span class="token punctuation">;</span>
<span class="token keyword">external</span> alert<span class="token punctuation">:</span> string <span class="token operator">=></span> void <span class="token operator">=</span> <span class="token string">"alert"</span> <span class="token punctuation">[</span><span class="token operator">@@</span>bs<span class="token punctuation">.</span><span class="token keyword">val</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
alert <span class="token string">"hello"</span><span class="token punctuation">;</span>
</code></pre>
<p>But what about when we want something more complicated? Here‚Äôs how we could call <code class="language-javascript">getContext</code> on a Canvas DOM node:</p>
<pre class="language-ocaml"><code class="language-ocaml"><span class="token keyword">type</span> canvas<span class="token punctuation">;</span>
<span class="token keyword">type</span> context<span class="token punctuation">;</span>
<span class="token operator">/*</span> we're leaving these types abstract<span class="token punctuation">,</span> because we won't
 <span class="token operator">*</span> be using them directly anywhere <span class="token operator">*/</span>
<span class="token keyword">external</span> getContext<span class="token punctuation">:</span> canvas <span class="token operator">=></span> string <span class="token operator">=></span> context <span class="token operator">=</span> <span class="token string">""</span> <span class="token punctuation">[</span><span class="token operator">@@</span>bs<span class="token punctuation">.</span>send<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> myCanvas<span class="token punctuation">:</span> canvas <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">%</span>bs<span class="token punctuation">.</span>raw <span class="token string">{| document.getElementById("mycanvas") |}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> ctx <span class="token operator">=</span> getContext myCanvas <span class="token string">"2d"</span><span class="token punctuation">;</span>
</code></pre>
<p>So let‚Äôs unpack what‚Äôs going on. We created some abstract types for the Canvas DOM node and the associated RenderingContext object.</p>
<p>Then we made a <code class="language-javascript">getContext</code> function, but instead of <code class="language-javascript">@@bs<span class="token punctuation">.</span>val</code> we used <code class="language-javascript">@@bs<span class="token punctuation">.</span>send</code>, and we used an empty string for the text of the external. <code class="language-javascript">@@bs<span class="token punctuation">.</span>send</code> means ‚Äúwe‚Äôre calling a method on the first argument‚Äù, which in this case is the canvas. BuckleScript will translate this into <code class="language-javascript">theFirstArgument<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span>theSecondArgument<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span></code>.</p>
<p>And the empty string means ‚Äúthe js-name is the same as the name we‚Äôre giving the external here in BuckleScript-land‚Äù, in this case <code class="language-javascript">getContext</code>. If we wanted to name it something else (like <code class="language-javascript">getRenderingContext</code>), when we‚Äôd have to supply the string <code class="language-javascript"><span class="token string">"getContext"</span></code> so that BuckleScript calls the right function.</p>
<p>Let‚Äôs add one more function just so it‚Äôs interesting.</p>
<pre class="language-ocaml"><code class="language-ocaml"><span class="token keyword">external</span> fillRect<span class="token punctuation">:</span> context <span class="token operator">=></span> float <span class="token operator">=></span> float <span class="token operator">=></span> float <span class="token operator">=></span> float <span class="token operator">=></span> unit <span class="token operator">=</span> <span class="token string">""</span> <span class="token punctuation">[</span><span class="token operator">@@</span>bs<span class="token punctuation">.</span>send<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>
<p>And now we can draw something!</p>
<pre class="language-ocaml"><code class="language-ocaml">fillRect ctx <span class="token number">0.0</span> <span class="token number">0.0</span> <span class="token number">100.0</span> <span class="token number">100.0</span><span class="token punctuation">;</span>
</code></pre>
<p>It‚Äôs not much, but adding other canvas methods is similar, and then you can start doing some <a href="https://twitter.com/jaredforsyth/status/871062358076030976">really fun things</a>.</p>
<p>So what does the compiled JavaScript look like?</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> tau <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2.0</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> myCanvas <span class="token operator">=</span> <span class="token punctuation">(</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"mycanvas"</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> ctx <span class="token operator">=</span> myCanvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">"2d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">100.0</span><span class="token punctuation">,</span> <span class="token number">100.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Wow! Notice how BuckleScript just inlined our <code class="language-javascript">pi</code> variable for us? And the output looks almost exactly like it was written by hand.</p>
<h2 id="What-s-next" tabindex="-1"><a class="header-anchor" href="#What-s-next">What‚Äôs next?</a></h2>
<p>Join us in our <a href="https://discord.gg/reasonml">Discord channel!</a></p>
<p>Check out the <a href="https://github.com/chenglou/reason-react-example">reason-react-example</a> repository if you want to make some UIs.</p>
<p>Here are some repositories that make use of externals:</p>
<ul>
<li><a href="https://github.com/jaredly/reason-maze">https://github.com/jaredly/reason-maze</a></li>
<li><a href="https://github.com/jaredly/rsnpaint">https://github.com/jaredly/rsnpaint</a></li>
<li><a href="https://github.com/chenglou/MariOCaml">https://github.com/chenglou/MariOCaml</a> (OCaml, not Reason syntax)</li>
</ul>
<p>If you‚Äôre starting into Reason, keep track of the things that confuse you and let us know! There‚Äôs lots of documentation work to do, and it will be best if it‚Äôs informed by people who are just starting out.</p>

</div>

 
</article>
</main>
<div style="height: 128px"></div>
</div>
<div style="flex-basis: 100px; flex-shrink: 1" class="style-ce615c601d9c9081e34880573a9c0d6582fa6737"></div>
</div>
</body>
</html>