<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf8"/>
<meta name="description" content="Thoughts about programming, mostly"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="HandheldFriendly" content="True"/>
<meta name="MobileOptimized" content="320"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="We can do better than semver | Jared Forsyth.com"/>
<meta name="twitter:description" content="Thoughts about programming, mostly"/>
<meta name="twitter:image" content="https://jaredforsyth.com/images/logo/JF_black_128.png"/>
<meta name="twitter:site" content="https://jaredforsyth.com"/>
<meta name="twitter:creator" content="@jaredforsyth"/>
<meta property="og:type" content="article"/>
<meta property="og:title" content="We can do better than semver | Jared Forsyth.com"/>
<meta property="og:description" content="Thoughts about programming, mostly"/>
<link rel="shortcut icon" href="/images/logo/JF_black_32.png"></link>
<title>
 
We can do better than semver | Jared Forsyth.com
 
</title>
<link rel="stylesheet" href="//brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Merriweather:200,200i,400,400i,700,700i/Open+Sans:400,400i,700,700i"></link>
<link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700" rel="stylesheet"></link>
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-one-light.min.css" rel="stylesheet" media="not (prefers-color-scheme: dark)"></link>
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-vsc-dark-plus.min.css" rel="stylesheet" media="(prefers-color-scheme: dark)"></link>
<script>
if (localStorage.viewMode) {
                    document.getElementsByTagName('html')[0].className = localStorage.viewMode;
                }
                window.addEventListener('load', () => {
                    const node = document.createElement('div');
                    const dark = document.createElement('a');
                    const light = document.createElement('a');
                    dark.className = 'dark-mode-button';
                    light.className = 'light-mode-button';

                    window.setMode = (mode) => {
                        if (localStorage.viewMode === mode) {
                            localStorage.viewMode = ''
                            document.getElementsByTagName('html')[0].className = 'mode-change'

                        } else {
                            localStorage.viewMode = mode
                            document.getElementsByTagName('html')[0].className = localStorage.viewMode + ' mode-change';
                        }
                    }
                    dark.onclick = (evt) => {
                        setMode('dark-mode');
                        evt.preventDefault()
                    }
                    light.onclick = (evt) => {
                        setMode('light-mode');
                        evt.preventDefault()
                    }

                    dark.textContent = 'dark mode';
                    dark.href = 'javascript:setMode("dark-mode")'
                    light.textContent = 'light mode';
                    light.href = 'javascript:setMode("light-mode")'
                    node.appendChild(dark)
                    node.appendChild(document.createTextNode(' · '));
                    node.appendChild(light)
                    Object.assign(node.style, {
                        position: 'absolute',
                        top: '8px',
                        right: '8px',
                    });
                    document.body.appendChild(node);
                })
                
</script>
<style>

    html.mode-change {
        transition: background-color .1s ease;
    }
    html.light-mode, :root {
        
        --color-text: #333;
        --color-lightText: #999;
        --color-red: #692900;
        --color-lightOrange: #fff4ef;
        --color-darkGreen: #147429;
        --color-green: #1fad3e;
        --color-code: #ffede4;
        --color-codeText: #692900;
        background-color: white;
    
    }

    @media (prefers-color-scheme: dark) {
        :root {
            
        --color-text: #ccc;
        --color-lightText: #999;
        --color-red: #1dd442;
        --color-lightOrange: #0f0d0d;
        --color-darkGreen: #d8ac7e;
        --color-green: #ef8d27;
        --color-code: #361402;
        --color-codeText: #f9d6bf;
        background-color: #21262c;
    
        }
    }

    html.dark-mode {
        
        --color-text: #ccc;
        --color-lightText: #999;
        --color-red: #1dd442;
        --color-lightOrange: #0f0d0d;
        --color-darkGreen: #d8ac7e;
        --color-green: #ef8d27;
        --color-code: #361402;
        --color-codeText: #f9d6bf;
        background-color: #21262c;
    
    }

    main a:not([href^="/"]):not([href^="#"]):after {
        color: red;
        content: '🌐';
        font-size: 70%;
        margin-left: 4px;
    }

    .dark-mode-button, .light-mode-button {
        text-decoration: none;
        color: var(--color-text);
    }

    html.dark-mode .dark-mode-button,
    html.light-mode .light-mode-button {
        text-decoration: underline;
        color: var(--color-green);
    }

    code[class*=language-], pre[class*=language-] {
        font-size: 90% !important;
    }

    #comments p {
        font-size: 90%;
    }
    #comments p:last-child {
        padding-bottom: 0;
    }
    #hn p {
        font-size: 60%;
        line-height: 1.8em;
    }
    #hn p:last-child {
        padding-bottom: 0;
    }

      div {
        flex-shrink: 0;
        flex-wrap: wrap;
        box-sizing: border-box;
        min-height: 0;
        min-width: 0;
      }
      span {
        box-sizing: border-box;
      }
      code[class*=language-], pre[class*=language-],
      pre {
        margin: 0;
        margin-bottom: 1.5em;
      }
      pre {
        line-height: 18px;
        font-size: 16px;
        /* white-space: pre-wrap; */
        overflow: auto;
        max-width: 100%;
        padding: 15px;
        /* border: 1px solid #ddd; */
        font-family: Inconsolata;
        background-color: var(--color-code);
        color: var(--color-codeText);
        border-radius: 4px;
      }
      img {
        max-width: 100%;
      }
      li > code,
      a > code,
      p > code {
        font-size: 90%;
        padding: 4px;
        background-color: var(--color-code);
        color: var(--color-codeText);
        border-radius: 4px;
        hyphens: none;
      }
      blockquote {
          margin: 0;
          margin-bottom: 1em;
          padding-left: 20px;
          border-left: 5px solid var(--color-green);
          font-style: italic;
      }
      blockquote.twitter-tweet {
        font-style: normal;
        border: 1px solid var(--color-green);
        border-radius: 4px;
        padding: 8px 16px;
        font-size: 20px;
      }
      div.note {
        font-style: italic;
        flex-wrap: nowrap;
        display: flex;
        align-items: flex-start;
        font-size: 90%;
      }
      div.note::before {
        margin-right: 8px;
        content: 'i';
        border: 1px solid #ccc;
        padding: 2px 10px;
        border-radius: 50px;
        font-family: arial;
        font-style: normal;
        font-size: 20px;
        display: inline;
        line-height: 1;
        margin-top: 5px;
      }
      a {
        color: var(--color-green);
        text-decoration: none;
        /* color: #28cc4c;
        text-decoration-color: #28cc4c; */
      }
      a:hover {
        text-decoration: underline;
      }
      h1 > a, h2 > a, h3 > a, h4 > a, h5 > a, h6 > a {
        text-decoration: none;
        color: inherit;
      }
      h1 > a:hover, h2 > a:hover, h3 > a:hover, h4 > a:hover, h5 > a:hover, h6 > a:hover,
      h1 > a:focus, h2 > a:focus, h3 > a:focus, h4 > a:focus, h5 > a:focus, h6 > a:focus {
        text-decoration: underline;
        color: var(--color-green);
      }
      ul, ol {
        margin-top: 0;
      }
      .post-body h1 {
        font-family: Open sans;
      }
      h2 {
        padding-bottom: 16px;
        font-size: 32px;
        margin: 0;
        margin-top: 1em;
      }
      p {
        margin: 0;
        padding-bottom: 1em;
      }
      blockquote > p:last-child {
        padding-bottom: 0;
      }
      h3 {
        margin-bottom: 8px;
        font-family: Open sans;
        font-weight: normal;
        margin-top: 8px;
        color: #6e6e6e;
        font-size: 30px;
      }
      h5 {
        font-family: open sans;
        margin: 0;
        margin-top: 16px;
      }
      /* a:visited {
        color: #333;
      } */
      
</style>
<style>
 
.style-bb1ef180179301565afe9016b11ab16ed7413965 {
  padding: 0 16px;
  flex-shrink: 1;
  overflow: auto;
}
.style-6ae0154d10d8b0dbf4c75fa5adb959a39f9a7739 {
  text-decoration: none;
  color: inherit;
}
.style-6ae0154d10d8b0dbf4c75fa5adb959a39f9a7739:hover {
  text-decoration: underline;
}
.style-989db2448f309bfdd99b513f37c84b8f5794d2b5 {

}
.style-0044f7a33153e82f3678591650843ffdc0f020fe {
  font-size: 16px;
  margin-bottom: 16px;
  display: block;
  line-height: 20px;
  color: currentColor;
  text-decoration: none;
}
.style-0044f7a33153e82f3678591650843ffdc0f020fe:hover {
  text-decoration: underline;
}
.style-600fca2a90c30e17c2a20ea4f2f653cf60098d5b {
  color: var(--color-lightText);
  display: flex;
  flex-direction: row;
}
.style-6606aec13088964cf60601b97b809ed39748bd13 {
  font-size: 16px;
}
.style-92b92032b41d8e558573c6926aeaeeb3456b873e {
  margin-top: 100px;
  font-size: 56px;
  margin-bottom: 16px;
  padding-top: 32px;
}
@media(max-width: 600px) {
.style-92b92032b41d8e558573c6926aeaeeb3456b873e {
  font-size: 32px;
  margin-top: 40px;
}
}
@media(max-width: 600px) {
.style-92b92032b41d8e558573c6926aeaeeb3456b873e {
  margin-top: 40px;
}
}
.style-d9a01dccc38720dfd616bfebd6cb0499248e200b {
  color: var(--color-lightText);
  font-family: Open sans;
  font-size: 14px;
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: flex-start;
}
.style-fde29ab0420a52958e612784d49ff404f48528ae {
  text-decoration: none;
}
.style-cda9f9781eb5258ad50a00716278a6233b0a6313 {
  font-size: 22px;
  line-height: 40px;
  hyphens: auto;
  font-family: Merriweather;
  font-weight: 200;
}
@media(max-width: 600px) {
.style-cda9f9781eb5258ad50a00716278a6233b0a6313 {
  font-size: 20px;
  line-height: 30px;
}
}
.style-57a1e73efc53b68c621225cf25b4e2ed02cca22e {
  font-size: 150%;
  margin-top: 32px;
}
.style-8d9cfececc003c11c826cc070b3f3f8540e766ad {
  font-size: 80%;
  margin-bottom: 32px;
}
.style-667abe6c048ee69d99fb7dd7f8540a331a6b8da6 {
  margin-top: 32px;
  display: block;
}
.style-42bcf7eee9158c499a38688255bda89587c35120 {
  display: flex;
  align-items: center;
}
.style-5058abd2de0c184a0637a38774283d02273ac952 {
  padding: 8px;
}
.style-18034b1f21f591004640f66a5572518b9e5eba73 {
  width: 40px;
  height: 40px;
  border-radius: 10px;
  margin-right: 16px;
}
.style-f6bbb3ec59f6b2a4a4ceb12a7aed8386f1c2a1cd {
  padding: 16px;
  margin-top: 16px;
  border-radius: 10px;
  background: var(--color-lightOrange);
}
.style-cd92fd8450a8c6641a2f0f2f0daac33e94b99b35 {
  font-family: Linux Libertine;
  color: var(--color-text);
  margin: 0;
  padding: 0;
}
.style-dc1f12ded94275ec46fa7abd837a78fd6347d5e4 {
  position: fixed;
  top: 10px;
  left: 10px;
  padding: 8px;
  background-color: black;
}
@media(min-width: 1061px) {
.style-dc1f12ded94275ec46fa7abd837a78fd6347d5e4 {
  display: none;
}
}
.style-f2140e5d177bae23c12d832734b5ce5fb0b21aa9 {
  height: 32px;
  width: 32px;
  background-size: cover;
}
.style-0da148fa6be0269fa24b9fd57a9a57aeb5297d0d {
  flex-direction: row;
  padding: 0 20px;
  display: flex;
  justify-content: center;
  align-items: stretch;
  flex-wrap: wrap;
  justify-content: flex-start;
  flex-wrap: nowrap;
}
@media(max-width: 1060px) {
.style-0da148fa6be0269fa24b9fd57a9a57aeb5297d0d {
  justify-content: center;
}
}
@media(max-width: 835px) {
.style-0da148fa6be0269fa24b9fd57a9a57aeb5297d0d {
  padding: 8px;
}
}
.style-9dc27aab0a26df3e65720efcd4de1d4b5e9e64f8 {
  background-color: var(--color-lightOrange);
  max-width: 400px;
  flex-shrink: 1;
  min-width: 300px;
  padding: 40px;
}
@media(max-width: 835px) {
.style-9dc27aab0a26df3e65720efcd4de1d4b5e9e64f8 {
  padding: 16px;
}
}
@media(max-width: 1650px) {
.style-9dc27aab0a26df3e65720efcd4de1d4b5e9e64f8 {
  padding: 20px;
}
}
@media(max-width: 1060px) {
.style-9dc27aab0a26df3e65720efcd4de1d4b5e9e64f8 {
  display: none;
}
}
.style-070d16e7de42659938f24594f2b149329d23dc29 {
  top: 40px;
}
@media(max-width: 835px) {
.style-070d16e7de42659938f24594f2b149329d23dc29 {
  top: 16px;
}
}
@media(max-width: 1650px) {
.style-070d16e7de42659938f24594f2b149329d23dc29 {
  top: 20px;
}
}
@media(min-width: 835px) {
.style-070d16e7de42659938f24594f2b149329d23dc29 {
  position: sticky;
  height: calc(100vh - 80px);
  display: flex;
  flex-wrap: nowrap;
  flex-direction: column;
}
}
.style-3ba81e27d2f8c377a36c12c6516f97660ec3facb {
  margin: 0 auto;
  width: 160px;
  overflow: hidden;
  height: 160px;
  display: block;
  border-radius: 50%;
  border: 5px solid white;
  background-color: white;
  box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3);
}
.style-1acf1679204e721558d0d3292da71a07307421a4 {
  display: block;
  width: 160px;
  height: 160px;
}
.style-0038018cf11394bd2f3cad50b7fc1d34d431f8b0 {
  text-align: center;
  font-size: 36px;
}
.style-683404bf430036582caafb930681970b717e3e38 {
  font-size: 24px;
  line-height: 36px;
  flex: 1;
  display: flex;
  flex-direction: column;
  flex-wrap: nowrap;
  text-align: left;
}
.style-da667265deef9362aecb588a818eaba3fef53068 {
  margin-bottom: 40px;
  justify-content: center;
  display: flex;
  flex-direction: row;
}
.style-da667265deef9362aecb588a818eaba3fef53068 a {
  margin: 0 8px;
}
.style-74e366023ce61639103d5fb83af3a27e33357285 {
  font-family: Open sans, sans-serif;
  font-size: 20px;
}
.style-74e366023ce61639103d5fb83af3a27e33357285 a {
  text-decoration: none;
}
.style-74e366023ce61639103d5fb83af3a27e33357285 a:hover {
  text-decoration: underline;
}
.style-ce615c601d9c9081e34880573a9c0d6582fa6737 {

}
@media(max-width: 1060px) {
.style-ce615c601d9c9081e34880573a9c0d6582fa6737 {
  display: none;
}
}
.style-cea2d442503956980c7eeb14acb78a14064ee9d4 {
  max-width: 700px;
}
@media(max-width: 1060px) {
.style-cea2d442503956980c7eeb14acb78a14064ee9d4 {
  flex-shrink: 1;
  min-width: 0;
}
}
 
</style>

                
</head>
<body class="style-cd92fd8450a8c6641a2f0f2f0daac33e94b99b35" lang="en">
<a href="/" class="style-dc1f12ded94275ec46fa7abd837a78fd6347d5e4"><div class="style-f2140e5d177bae23c12d832734b5ce5fb0b21aa9" style="background-image: url(/images/logo/JF_64.png)"></div></a>
<div class="style-0da148fa6be0269fa24b9fd57a9a57aeb5297d0d">
<div class="style-9dc27aab0a26df3e65720efcd4de1d4b5e9e64f8">
<div class="style-070d16e7de42659938f24594f2b149329d23dc29">
<a href="/" class="style-3ba81e27d2f8c377a36c12c6516f97660ec3facb"><img src="https://www.gravatar.com/avatar/313878fc8f316fc3fe4443b13913d0a4.png?s=200" alt="Jared Forsyth" class="style-1acf1679204e721558d0d3292da71a07307421a4"/></a>
<div style="height: 40px"></div>
<div class="style-0038018cf11394bd2f3cad50b7fc1d34d431f8b0">I'm Jared Forsyth</div>
<div style="height: 40px"></div>
<div class="style-683404bf430036582caafb930681970b717e3e38">
<div class="style-da667265deef9362aecb588a818eaba3fef53068">
<a href="/">home</a>
<a href="/posts/">posts</a>
<a href="/projects/">projects</a>
<a href="/talks/">talks</a>
</div>
<div class="style-bb1ef180179301565afe9016b11ab16ed7413965">
<a href="/posts/" class="style-6ae0154d10d8b0dbf4c75fa5adb959a39f9a7739"><div class="style-989db2448f309bfdd99b513f37c84b8f5794d2b5">Latest posts</div></a>
<div style="height: 8px"></div>
<a href="/posts/type-inference-that-sticks/" class="style-0044f7a33153e82f3678591650843ffdc0f020fe">
<div>
 
Type inference that sticks
 
</div>
<div class="style-600fca2a90c30e17c2a20ea4f2f653cf60098d5b">
2023
February
4
</div>
</a>
<a href="/posts/whats-cool-about-unison/" class="style-0044f7a33153e82f3678591650843ffdc0f020fe">
<div>
 
What's cool about Unison?
 
</div>
<div class="style-600fca2a90c30e17c2a20ea4f2f653cf60098d5b">
2021
March
2
</div>
</a>
<a href="/posts/local-first-database-hypermerge/" class="style-0044f7a33153e82f3678591650843ffdc0f020fe">
<div>
 
Local-first database: Hypermerge
 
</div>
<div class="style-600fca2a90c30e17c2a20ea4f2f653cf60098d5b">
2020
September
30
</div>
</a>
<a href="/posts/local-first-database-rxdb-pouchdb/" class="style-0044f7a33153e82f3678591650843ffdc0f020fe">
<div>
 
Local-first database: RxDB + PouchDB
 
</div>
<div class="style-600fca2a90c30e17c2a20ea4f2f653cf60098d5b">
2020
May
12
</div>
</a>
<a href="/posts/local-first-database-remotestorage/" class="style-0044f7a33153e82f3678591650843ffdc0f020fe">
<div>
 
Local-first database: remoteStorage.js
 
</div>
<div class="style-600fca2a90c30e17c2a20ea4f2f653cf60098d5b">
2020
May
6
</div>
</a>
<a href="/posts/local-first-database-gun-js/" class="style-0044f7a33153e82f3678591650843ffdc0f020fe">
<div>
 
Local-first database: gun.js
 
</div>
<div class="style-600fca2a90c30e17c2a20ea4f2f653cf60098d5b">
2020
May
1
</div>
</a>
<a href="/posts/in-search-of-a-local-first-database/" class="style-0044f7a33153e82f3678591650843ffdc0f020fe">
<div>
 
In Search of a Local-First Database
 
</div>
<div class="style-600fca2a90c30e17c2a20ea4f2f653cf60098d5b">
2020
April
11
</div>
</a>
<a class="style-6606aec13088964cf60601b97b809ed39748bd13" href="/posts/">More...</a>
<div style="height: 32px"></div>
</div>
<div style="text-align:center" class="style-74e366023ce61639103d5fb83af3a27e33357285">
<a href="https://bsky.app/profile/jaredforsyth.com">🦋 bsky/@jaredforsyth.com</a>
<a href="https://twitter.com/jaredforsyth">twitter/@jaredforsyth</a>
<br/>
<a href="https://mastodon.social/@jaredly">@jaredly@mastodon.social</a>
<br/>
<a href="https://github.com/jaredly">github/@jaredly</a>
<br/>
<a href="/posts/rss.xml">posts rss feed</a>
</div>
</div>
</div>
</div>
<div style="flex-basis: 100px; flex-shrink: 1" class="style-ce615c601d9c9081e34880573a9c0d6582fa6737"></div>
<div class="style-cea2d442503956980c7eeb14acb78a14064ee9d4">
<main role="main">
<article>
 
<h1 class="style-92b92032b41d8e558573c6926aeaeeb3456b873e">We can do better than semver</h1>
<div class="style-d9a01dccc38720dfd616bfebd6cb0499248e200b">
April
<div style="flex-basis: 4px"></div>
14,
<div style="flex-basis: 4px"></div>
2025
<div style="flex-basis: 8px"></div>
 · 
<div style="flex-basis: 8px"></div>
<a href="/tags/kipos/" class="style-fde29ab0420a52958e612784d49ff404f48528ae">kipos</a>, <div style="flex-basis: 4px"></div><a href="/tags/package management/" class="style-fde29ab0420a52958e612784d49ff404f48528ae">package management</a>, <div style="flex-basis: 4px"></div><a href="/tags/programming languages/" class="style-fde29ab0420a52958e612784d49ff404f48528ae">programming languages</a>
<div style="flex-basis: 8px"></div>
<span style="background-color: red; padding: 4px 8px; display: inline-block; color: white; border-radius: 4px">draft</span>
</div>
<div style="height: 32px"></div>
<div class="post-body style-cda9f9781eb5258ad50a00716278a6233b0a6313">
<blockquote>
<p>A vision for validated versioning</p>
</blockquote>
<p>Upgrading libraries is both (a) an annoying chore, and (b) has high uncertainty about how “safe” it is to do.
We rely on semantic versioning to signpost when a library undergoes a “breaking change”, but this is far from reliable.</p>
<p>I think a lot of the issues around versioning &amp; dependency management come down to the fact that versioning is currently “stringly typed”: we rely on documentation, readmes, and changelogs (none of which can be statically validated) to indicate versioning guarantees. We can do better.</p>
<h2 id="Side-note-on-surface-area" tabindex="-1"><a class="header-anchor" href="#Side-note-on-surface-area">Side note on surface area</a></h2>
<p>On problem closely tied to versioning is that of “API surface area”. In many languages (Java, Go, NodeJS, OCaml, Elm, Haskell, Koka, Scala), there’s no way to have a “private module”: if you want definitions to be usable in other modules in the package, they also are made available to consumers of the package. In some languages (Python, PHP) you can’t even have private declarations, so the technical “surface area” of a library is <em>literally all of your code</em>. (Rust, Swift, and OCaml+Dune stand out as exceptions to this, although none goes as far as I want).</p>
<p>This leaves you reliant on convention and documentation to indicate “what the publicly-dependable API consists of” (e.g. “don’t import the module named Internal, it may change at any time”).</p>
<p>Wouldn’t it be nice if our languages actually supported limiting the API surface area of a library?</p>
<h2 id="Automatic-determination-of-breaking-changes" tabindex="-1"><a class="header-anchor" href="#Automatic-determination-of-breaking-changes">Automatic determination of breaking changes</a></h2>
<p>Of course, once we’ve locked down the API surface area, there’s still the problem of determining whether a version includes breaking changes. Why leave that up to changelogs, when we can do better?</p>
<p>Here’s the vision: breaking changes are statically validatable through a combination of <strong>type compatability</strong> (what Elm does) and <strong>test compatability</strong> (I don’t know of any language that does this).</p>
<ol>
<li>if the type of a function changes in a non-backwards-compatible way, that’s a breaking change</li>
<li>if any tests of that function from the previous version fail with the new version’s implementation, that’s a breaking change</li>
</ol>
<p>In this way, <strong>the test suite of the public API represents the behavioral guarantees of the library.</strong></p>
<p>This can also allow the package manager to isolate breaking changes to the specific declaration that they impact – if your project doesn’t use that function, then the version isn’t a breaking change for you.</p>
<p>This also means that version numbers are not an indication of breaking changes; we can instead have them be an indicator of when the version was released, e.g. 20250414.</p>
<p>Now let’s talk about resolution. The current state of things (with Rust, NPM, Pip) is that a library will specify a range of versions that it is compatible with. In general, this relies on semantic-versioning ranges, which are both too weak (stringly typed) and too restrictive (if the breaking change applies to a method I’m not using, it shouldn’t be breaking for me).</p>
<p>What I envision is this: a library <strong>A</strong> specifies a single version for a dependency <strong>B</strong>. This is “the version it has been developed against”. (in this way, it removes some uncertainty around “what is the /recommended/ version of a thing for a given library”). But because we have validated versioning, the package manager is free to install a newer version of dependency <strong>B</strong>, as long as it is determined to be backwards compatible with the requested version, and as long as all of <strong>A</strong>’s tests continue to pass.</p>
<p>To add a bit more flexibility, we could have the library also specify a “minimum compatible version” in addition to the “recommended version”. There are certainly cases where you would want to have a lower version than a library might have been developed against, and it would be good for our dependency metadata to make that easy to do.</p>
<h2 id="How-would-lockfiles-resolutions-work" tabindex="-1"><a class="header-anchor" href="#How-would-lockfiles-resolutions-work">How would lockfiles &amp; resolutions work?</a></h2>
<p>(I’m still at the “idea” stages for this, so I haven’t fleshed everything out, but here goes)</p>
<p>Libraries would have lockfiles. In the same way that it’s nice to know the specific version of a dependency that the library was developed against, I would want to download whole exact tree of dependencies that the library was developed against, absent any reason not to (such as a conflicting requirement from another library).</p>
<p>When specifying dependencies (in the equivalent of a <code class="language-javascript"><span class="token keyword">package</span><span class="token punctuation">.</span>json</code> or <code class="language-javascript">cargo<span class="token punctuation">.</span>toml</code>), you would also be able to override the resolution of a transitive dependency, if desired.</p>
<h2 id="How-do-you-deal-with-multiple-versions-of-the-same-package-in-your-tree" tabindex="-1"><a class="header-anchor" href="#How-do-you-deal-with-multiple-versions-of-the-same-package-in-your-tree">How do you deal with “multiple versions of the same package in your tree”</a></h2>
<p>I’ve run into this issue in JavaScript (multiple versions of React having independent global state that causes errors), Rust (two types from different versions of a library leading to the confusing <code class="language-javascript"><span class="token string">"found a::b::Foo, expected a::b::Foo"</span></code>, and Java (I don’t remember why, but my <code class="language-javascript">build<span class="token punctuation">.</span>gradle</code> has a bunch of <code class="language-javascript">exclude group</code> declarations).</p>
<p>I think it ought to be statically analyzeable whether a library’s use of a dependency is “leaky”. This would either be due to (a) global state being accessed, or (b) some types that are declared in the dependency being “visible” in the library’s public API. A “leaky” dependency would therefore need to be locked down so that there’s only one instance of it between all its consumers, but a “non-leaky” dependency could be free to have multiple independent versions in use.</p>
<p>Of course, for code size reasons it could be desirable to have more deduplication than the static analysis deems necessary, so we might want to have the “isolated dependency” behavior be opt-in instead of opt-out.</p>
<h2 id="Migrations-can-we-have-them" tabindex="-1"><a class="header-anchor" href="#Migrations-can-we-have-them">Migrations, can we have them</a></h2>
<p>We can take our “breaking changes” story one step further by introducing <a href="https://welltypedwitch.bearblog.dev/the-way-were-thinking-about-breaking-changes-is-really-silly/">migration macros</a>. There is a class of breaking changes that can be alleviated by making a relatively simple source code transformation of each call site. Examples include: removal of an unused function parameter, changing the type of an argument from <code class="language-javascript">int</code> to <code class="language-javascript">Option<span class="token operator">&lt;</span>int<span class="token operator">></span></code>, swapping the order of two arguments of the same type, etc.</p>
<p>When publishing a new version of your library, you would be able to specify migration macros for public API declarations that have had such signature changes, turning what would otherwise be a breaking change into a non-breaking one.</p>
<h2 id="What-if-nothing-ever-breaks" tabindex="-1"><a class="header-anchor" href="#What-if-nothing-ever-breaks">What if nothing ever breaks?</a></h2>
<p>A further extension of these ideas that I’m considering is to just never allow breaking changes. This is in line with <a href="https://research.swtch.com/vgo-import">Golang’s ethos</a>, where a “new major version” of a package is treated as a “new package”: instead of “auth”, we’re using “auth/v2”. There’s a definite appeal to this, in that it encourages a high commitment to compatability, while also allowing for a clean break when such is necessary. (in the absence of migrations, such a policy would be needlessly restrictive, so it’s a good thing we’ve accounted for them)</p>
<p>One issue this would hopefully eliminate is the need to handle “un-breaking” versions; e.g. if version 20250411 had a breaking change, and then 20250412 “reverted” that breaking change, it would be great if a package manager were able to “know” that it can just skip over 20250411 and continue with compatible upgrades. This could add quite a bit of complexity however, and so it’s appealing to just “eliminate casual breaking changes” out of hand.</p>
<h2 id="FAQ" tabindex="-1"><a class="header-anchor" href="#FAQ">FAQ</a></h2>
<blockquote>
<p>Why are you playing around with dependency management of a single language? You should be working on whole-system (cross-language) dependency management a la Nix.</p>
</blockquote>
<p>I dunno, I want to have nice things? And a whole-system package manager can only be as smart as the dumbest language. I want smarter languages.</p>
<blockquote>
<p><a href="https://odin-lang.org/docs/faq/#how-do-i-manage-my-code-without-a-package-manager">Packages should be hand-curated, not managed by soulless machines</a></p>
</blockquote>
<p>I believe that the main critiques of package management are attributable to (1) having a language that is oblivious to the notion of a package, and (2) critiques of human-curated semver, which is precisely what I’m hoping to supplant. There’s also (3), “trust no one, the world will betray you”, and that’s a social problem that it seems the Elm community is doing a good job of combatting.</p>
<blockquote>
<p>Doesn’t this require the package-manager / compiler to be able to run the tests for a library? Should we really be baking testing into the language itself?</p>
</blockquote>
<p>Yes, yes it does. If you’re building a language that doesn’t have unit testing built into it, what are you playing at.</p>

</div>
<section class="style-cda9f9781eb5258ad50a00716278a6233b0a6313">
<div class="style-57a1e73efc53b68c621225cf25b4e2ed02cca22e">Comments</div>
<div class="style-8d9cfececc003c11c826cc070b3f3f8540e766ad">
courtesy of
 
<a href="https://gist.github.com/532e48dc531c57cf405218b44d5a5de0" target="_blank">github gists</a>
</div>
<div id="comments" data-gist="532e48dc531c57cf405218b44d5a5de0">Loading comments...</div>
<a href="https://gist.github.com/532e48dc531c57cf405218b44d5a5de0#comments" target="_blank" class="style-667abe6c048ee69d99fb7dd7f8540a331a6b8da6">Add a comment on github</a>
<div id="hn"></div>
<script async="true">
const loadComments = (gist, hackerNews, styles) => {
  const node = document.getElementById("comments");
  node.textContent = "Fetching from github...";
  const loadMarkdown = () => new Promise((resolve, reject) => {
    const script = document.createElement("script");
    script.src = "https://cdnjs.cloudflare.com/ajax/libs/markdown-it/13.0.1/markdown-it.min.js";
    script.onload = () => resolve(window.markdownit);
    script.onerror = () => reject(new Error("Unable to load markdown-it"));
    document.head.append(script);
  });
  const waitForMarkdown = loadMarkdown();
  if (hackerNews) {
    const second = document.getElementById("hn");
    second.textContent = "Fetching hn comments ...";
    fetch(`https://hn.algolia.com/api/v1/items/${hackerNews}`).then((res) => res.json()).then((raw2) => {
      const top = raw2;
      if (!top.children.length) {
        return;
      }
      waitForMarkdown.then((markdown) => {
        const renderHn = (comment) => {
          if (!comment.text) {
            console.warn("no", comment);
            return document.createTextNode("");
          }
          const node2 = document.createElement("div");
          node2.className = styles.comment;
          node2.innerHTML = `
                    <div class="${styles.top}">
                    <a href="https://news.ycombinator.com/item?id=${comment.id}" target="_blank">
                        ${comment.author} on ${new Date(
            comment.created_at
          ).toLocaleDateString()}
                    </a>
                    </div>
                    <div class="${styles.body}">
                        ${comment.text}
                    </div>
                `;
          if (comment.children.length) {
            const children = document.createElement("div");
            children.style.paddingLeft = "8px";
            children.style.borderLeft = "16px solid var(--color-lightOrange)";
            children.style.marginTop = "16px";
            comment.children.forEach((child) => {
              children.append(renderHn(child));
            });
            node2.append(children);
          }
          return node2;
        };
        second.innerHTML = `
            <div style="font-size: 150%; margin-top: 40px">
                Commentary
            </div>
            <div style="font-size: 80%; margin-bottom: 32px">
                courtesy of <a href="https://news.ycombinator.com/item?id=${hackerNews}" target="_blank">
                    hacker news
                </a>
            </div>`;
        top.children.forEach((child) => {
          second.append(renderHn(child));
        });
      });
    });
  }
  fetch(`https://api.github.com/gists/${gist}/comments?per_page=100`, {
    headers: {
      Accept: "application/vnd.github+json"
    }
  }).then((res) => res.json()).then((raw2) => {
    const comments = raw2;
    if (!comments.length) {
      node.textContent = "No comments yet!";
      return;
    }
    waitForMarkdown.then((markdown) => {
      node.textContent = "";
      comments.forEach((comment) => {
        const cm = document.createElement("div");
        cm.className = styles.comment;
        cm.innerHTML = `
                    <div class="${styles.top}">
                    <img src="${comment.user.avatar_url}"
                    class="${styles.avatar}" />
                    <a href="https://gist.github.com/${gist}?permalink_comment_id=${comment.id}#gistcomment-${comment.id}" target="_blank">
                        ${comment.user.login} on ${new Date(
          comment.created_at
        ).toLocaleDateString()}
                    </a>
                    </div>
                    <div class="${styles.body}">
                        ${markdown({ linkify: true, breaks: true }).render(
          comment.body
        )}
                    </div>
                    `;
        node.append(cm);
      });
    });
  });
};
                        const styles = {"top":"style-42bcf7eee9158c499a38688255bda89587c35120","comment":"style-5058abd2de0c184a0637a38774283d02273ac952","avatar":"style-18034b1f21f591004640f66a5572518b9e5eba73","body":"style-f6bbb3ec59f6b2a4a4ceb12a7aed8386f1c2a1cd"};
                        let observer = new IntersectionObserver((entries) => {
                            if (!entries[0].isIntersecting) return;
                            observer.disconnect();
                            loadComments("532e48dc531c57cf405218b44d5a5de0", null, styles);
                        }, {rootMargin: '200px'});
                        observer.observe(document.getElementById('comments'));
                        
</script>
</section>
 
</article>
</main>
<div style="height: 128px"></div>
</div>
<div style="flex-basis: 100px; flex-shrink: 1" class="style-ce615c601d9c9081e34880573a9c0d6582fa6737"></div>
</div>
</body>
</html>