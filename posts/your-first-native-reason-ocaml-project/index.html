<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf8">
<meta name="description" content="A quick tutorial where we build a simple cli program"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="HandheldFriendly" content="True"/>
<meta name="MobileOptimized" content="320"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Your first native Reason/OCaml project | Jared Forsyth.com"/>
<meta name="twitter:description" content="A quick tutorial where we build a simple cli program"/>
<meta name="twitter:image" content="https://jaredforsyth.com/images/logo/JF_black_128.png"/>
<meta name="twitter:site" content="https://jaredforsyth.com"/>
<meta name="twitter:creator" content="@jaredforsyth"/>
<meta property="og:type" content="article"/>
<meta property="og:title" content="Your first native Reason/OCaml project | Jared Forsyth.com"/>
<meta property="og:description" content="A quick tutorial where we build a simple cli program"/>
<link rel="shortcut icon" href="/images/logo/JF_black_32.png"></link>
<title>Your first native Reason/OCaml project | Jared Forsyth.com</title>
<link rel="stylesheet" href="//brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i"></link>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata:400,700"></link>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/themes/prism.min.css"></link>
<style>

      div {
        flex-shrink: 0;
        flex-wrap: wrap;
        box-sizing: border-box;
        min-height: 0;
        min-width: 0;
      }
      span {
        box-sizing: border-box;
      }
      pre {
        line-height: 18px;
        font-size: 16px;
        /* white-space: pre-wrap; */
        overflow: auto;
        max-width: 100%;
        padding: 15px;
        /* border: 1px solid #ddd; */
        font-family: Inconsolata;
        background-color: #fff4ef;
        color: #692900;
        border-radius: 4px;
        margin: 0;
        margin-bottom: 1em;
      }
      img {
        max-width: 100%;
      }
      li > code,
      a > code,
      p > code {
        font-size: 90%;
        padding: 4px;
        background-color: #ffede4;
        color: #692900;
        border-radius: 4px;
        hyphens: none;
      }
      blockquote {
          margin: 0;
          margin-bottom: 1em;
          padding-left: 20px;
          border-left: 5px solid #1fad3e;
          font-style: italic;
      }
      blockquote.twitter-tweet {
        font-style: normal;
        border: 1px solid #1fad3e;
        border-radius: 4px;
        padding: 8px 16px;
        font-size: 20px;
      }
      div.note {
        font-style: italic;
        flex-wrap: nowrap;
        display: flex;
        align-items: flex-start;
        font-size: 90%;
      }
      div.note::before {
        margin-right: 8px;
        content: 'i';
        border: 1px solid #ccc;
        padding: 2px 10px;
        border-radius: 50px;
        font-family: arial;
        font-style: normal;
        font-size: 20px;
        display: inline;
        line-height: 1;
        margin-top: 5px;
      }
      a {
        color: #1fad3e;
        /* color: #28cc4c;
        text-decoration-color: #28cc4c; */
      }
      h1 > a, h2 > a, h3 > a, h4 > a, h5 > a, h6 > a {
        text-decoration: none;
        color: inherit;
      }
      h1 > a:hover, h2 > a:hover, h3 > a:hover, h4 > a:hover, h5 > a:hover, h6 > a:hover,
      h1 > a:focus, h2 > a:focus, h3 > a:focus, h4 > a:focus, h5 > a:focus, h6 > a:focus {
        text-decoration: underline;
        color: #1fad3e;
      }
      ul, ol {
        margin-top: 0;
      }
      .post-body h1 {
        font-family: Open sans;
      }
      h2 {
        padding-bottom: 16px;
        font-size: 32px;
        margin: 0;
        margin-top: 1em;
      }
      p {
        margin: 0;
        padding-bottom: 1em;
      }
      blockquote > p:last-child {
        padding-bottom: 0;
      }
      h3 {
        margin-bottom: 8px;
        font-family: Open sans;
        font-weight: normal;
        margin-top: 8px;
        color: #6e6e6e;
        font-size: 30px;
      }
      h5 {
        font-family: open sans;
        margin: 0;
        margin-top: 16px;
      }
      /* a:visited {
        color: #333;
      } */
      
</style>
<style>
.style-562977262 {
  max-width: 700px;
}
@media(max-width: 1060px) {
.style-562977262 {
  flex-shrink: 1;
  min-width: 0;
}
}
.style-362825327 {
  display: block;
  width: 160px;
  height: 160px;
}
.style-105406039 {
  font-size: 24px;
  line-height: 36px;
  hyphens: auto;
}
@media(max-width: 600px) {
.style-105406039 {
  font-size: 20px;
  line-height: 30px;
}
}
.style-378508498 {
  color: #999;
  font-family: Open sans;
  font-size: 14px;
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: flex-start;
}
.style-254026428 {
  font-family: Open sans, sans-serif;
  font-size: 20px;
}
.style-254026428 a {
  text-decoration: none;
}
.style-254026428 a:hover {
  text-decoration: underline;
}
.style-231757563 {
  font-family: Linux Libertine;
  color: #333;
  margin: 0;
  padding: 0;
}
.style-665563595 {
  flex-shrink: 1;
  overflow: auto;
}
.style-723831218 {
  font-size: 24px;
  line-height: 36px;
  flex: 1;
  display: flex;
  flex-direction: column;
  flex-wrap: nowrap;
  text-align: left;
}
.style-679839639 {
  background-color: #fff4ef;
  max-width: 400px;
  flex-shrink: 1;
  min-width: 300px;
  padding: 40px;
}
@media(max-width: 835px) {
.style-679839639 {
  padding: 16px;
}
}
@media(max-width: 1650px) {
.style-679839639 {
  padding: 20px;
}
}
@media(max-width: 1060px) {
.style-679839639 {
  display: none;
}
}
.style-74395582 {
  color: #999;
  display: flex;
  flex-direction: row;
}
.style-129913994 {

}
.style-507597651 {
  text-decoration: none;
}
.style-627275581 {
  margin-top: 100px;
  font-size: 56px;
  margin-bottom: 16px;
  padding-top: 32px;
}
@media(max-width: 600px) {
.style-627275581 {
  font-size: 32px;
  margin-top: 40px;
}
}
@media(max-width: 600px) {
.style-627275581 {
  margin-top: 40px;
}
}
.style-817623655 {
  padding: 0 16px;
  flex-shrink: 1;
  overflow: auto;
}
.style-760303782 {
  margin-bottom: 40px;
  justify-content: center;
  display: flex;
  flex-direction: row;
}
.style-760303782 a {
  margin: 0 8px;
}
.style-179062008 {
  flex-direction: row;
  padding: 0 20px;
  display: flex;
  justify-content: center;
  align-items: stretch;
  flex-wrap: wrap;
  justify-content: flex-start;
  flex-wrap: nowrap;
}
@media(max-width: 1060px) {
.style-179062008 {
  justify-content: center;
}
}
@media(max-width: 835px) {
.style-179062008 {
  padding: 8px;
}
}
.style-504547095 {
  margin: 0 auto;
  width: 160px;
  overflow: hidden;
  height: 160px;
  display: block;
  border-radius: 50%;
  border: 5px solid white;
  background-color: white;
  box-shadow: 0 1px 1px rgba(0, 0, 0, 0.3);
}
.style-310129452 {
  text-align: center;
  font-size: 36px;
}
.style-580730263 {
  top: 40px;
}
@media(max-width: 835px) {
.style-580730263 {
  top: 16px;
}
}
@media(max-width: 1650px) {
.style-580730263 {
  top: 20px;
}
}
@media(min-width: 835px) {
.style-580730263 {
  position: sticky;
  height: calc(100vh - 40px);
  display: flex;
  flex-wrap: nowrap;
  flex-direction: column;
}
}
.style-466863072 {

}
@media(max-width: 1060px) {
.style-466863072 {
  display: none;
}
}
.style-245007015 {
  font-size: 16px;
  margin-bottom: 16px;
  display: block;
  line-height: 20px;
  color: currentColor;
  text-decoration: none;
}
.style-245007015:hover {
  text-decoration: underline;
}
</style>
</head>
<body class="style-231757563" lang="en">
<div class="style-179062008">
<div class="style-679839639">
<div class="style-580730263">
<a href="/" class="style-504547095"><img src="https://www.gravatar.com/avatar/313878fc8f316fc3fe4443b13913d0a4.png?s=200" alt="Jared Forsyth" class="style-362825327"/></a>
<div style="height: 40px"></div>
<div class="style-310129452">I'm Jared Forsyth</div>
<div style="height: 40px"></div>
<div class="style-723831218">
<div class="style-760303782">
<a href="/">home</a>
<a href="/posts/">posts</a>
<a href="/projects/">projects</a>
<a href="/talks/">talks</a>
</div>
<div class="style-817623655">
<div class="style-129913994">Recent posts</div>
<div style="height: 8px"></div>
<a href="/posts/hybrid-logical-clocks/" class="style-245007015">
<div>Hybrid Logical Clocks</div>
<div class="style-74395582">
2020
February
14
</div>
</a>
<a href="/posts/my-scientific-sourdough/" class="style-245007015">
<div>My Scientific Sourdough üçû</div>
<div class="style-74395582">
2019
December
31
</div>
</a>
<a href="/posts/announcing-milk/" class="style-245007015">
<div>Automatic, well-typed JSON serialization in Reason/OCaml with Milk ü•õ</div>
<div class="style-74395582">
2019
May
28
</div>
</a>
<a href="/posts/intoducing-terraform/" class="style-245007015">
<div>Terraform: generate 3-d models of geographic terrain</div>
<div class="style-74395582">
2019
May
16
</div>
</a>
<a href="/posts/optional-attribute-access-in-reason/" class="style-245007015">
<div>Optional Attribute Access in Reason</div>
<div class="style-74395582">
2018
November
13
</div>
</a>























<div style="height: 32px"></div>
</div>
<div class="style-254026428" style="text-align:center">
<a href="https://twitter.com/jaredforsyth">twitter/@jaredforsyth</a>
<br/>
<a href="https://github.com/jaredly">github/@jaredly</a>
</div>
</div>
</div>
</div>
<div class="style-466863072" style="flex-basis: 100px; flex-shrink: 1"></div>
<div class="style-562977262">
<main role="main">
<article>
<h1 class="style-627275581">Your first native Reason/OCaml project</h1>
<div class="style-378508498">
June
<div style="flex-basis: 4px"></div>
17,
<div style="flex-basis: 4px"></div>
2017
<div style="flex-basis: 8px"></div>
 ¬∑ 
<div style="flex-basis: 8px"></div>
<a href="/tags/tutorial/" class="style-507597651">tutorial</a>, <div style="flex-basis: 4px"></div><a href="/tags/ocaml/" class="style-507597651">ocaml</a>, <div style="flex-basis: 4px"></div><a href="/tags/reason/" class="style-507597651">reason</a>
<div style="flex-basis: 8px"></div>

</div>
<div style="height: 32px"></div>
<div class="post-body style-105406039">
<p>I just wrote my first Reason project that compiled to native, and you can too! Luckily for you, my first native project was a cli tool to help people get started with native Reason development üôå.</p>
<!-- more -->

<blockquote><p>If you&#39;re more interested in targeting JavaScript, I wrote <a href="http://jaredforsyth.com/2017/06/03/getting-started-with-reason-and-bucklescript/" target="_blank">two</a> <a href="http://jaredforsyth.com/2017/06/03/javascript-interop-with-reason-and-bucklescript/" target="_blank">tutorials</a> about that to get you started.</p>
</blockquote>

<p>What will we be doing?</p>
<ul><li>project setup</li><li>building &amp; running</li><li>parsing cli arguments</li></ul>

<h2 id="Project-Setup"><a href="#Project-Setup">Project Setup</a></h2>

<p>First, you&#39;ll need to install OCaml on your machine if you don&#39;t have it already. <code>brew install ocaml</code> on macos, <code>apt-get install ocaml</code> on debian/ubuntu, with instructions for more platforms <a href="http://opam.ocaml.org/doc/Install.html" target="_blank">here</a>.</p>
<p>Then we&#39;ll install <a href="https://github.com/jaredly/ohai" target="_blank">ohai</a>, the tool I made for configuring a new native reason project. You can think of it as the <code>npm init</code> or <code>cargo new</code> for Reason/OCaml.</p>
<pre class='bash'><code class='bash'>opam pin add ohai git+https://github.com/jaredly/ohai#1.0.1</code></pre>

<p>Finally, let&#39;s setup the project!</p>
<pre class='bash'><code class='bash'>ohai init --bin my_cli</code></pre>

<p>You&#39;ll see that a bunch of files have been created for you - go ahead and take a look in each to see what&#39;s there.</p>
<pre class='bash'><code class='bash'>~$ tree
.
‚îú‚îÄ‚îÄ Makefile
‚îú‚îÄ‚îÄ bin
‚îÇ   ‚îú‚îÄ‚îÄ jbuild
‚îÇ   ‚îî‚îÄ‚îÄ my_cli.re
‚îú‚îÄ‚îÄ jbuild-workspace.dev
‚îú‚îÄ‚îÄ lib
‚îÇ   ‚îú‚îÄ‚îÄ Main.re
‚îÇ   ‚îî‚îÄ‚îÄ jbuild
‚îú‚îÄ‚îÄ test
‚îÇ   ‚îú‚îÄ‚îÄ jbuild
‚îÇ   ‚îî‚îÄ‚îÄ test.re
‚îî‚îÄ‚îÄ my_cli.opam</code></pre>

<p>So we&#39;ve got 3 directories - <code>lib</code> is where our functionality lives, <code>bin</code> just has a single top-level call into <code>lib/Main.re</code>, and <code>test</code> will have any tests we write.</p>
<h2 id="Building-amp-Running"><a href="#Building-amp-Running">Building &amp; Running</a></h2>

<p>If you run <code>make run</code> it will build your project and run the built executable.</p>
<pre class='bash'><code class='bash'>~$ make run
jbuilder build @install
       refmt bin/my_cli.re.ml
    ocamldep bin/my_cli.depends.ocamldep-output
      ocamlc lib/lib.{cmi,cmo,cmt}
       refmt lib/Main.re.ml
    ocamldep lib/lib.depends.ocamldep-output
      ocamlc lib/lib__Main.{cmi,cmo,cmt}
      ocamlc bin/my_cli.{cmi,cmo,cmt}
    ocamlopt lib/lib.{cmx,o}
    ocamlopt lib/lib__Main.{cmx,o}
    ocamlopt lib/lib.{a,cmxa}
    ocamlopt bin/my_cli.{cmx,o}
    ocamlopt bin/my_cli.exe
jbuilder exec my_cli
Hello world</code></pre>

<p>As you can see, the makefile first ran <code>jbuilder build @install</code>, which means &quot;build everything you know about&quot;, and then <code>jbuilder exec my_cli</code>. The latter is shorthand for <code>./_build/default/bin/my_cli.exe</code>.</p>
<h2 id="Parsing-CLI-Arguments"><a href="#Parsing-CLI-Arguments">Parsing CLI Arguments</a></h2>

<blockquote><p>If you haven&#39;t already, look through the <a href="https://facebook.github.io/reason/" target="_blank">docs for Reason</a> for a primer on the syntax. The documentation for the <a href="https://caml.inria.fr/pub/docs/manual-ocaml/libref/index.html" target="_blank">OCaml standard library</a> can also be useful.</p>
</blockquote>

<h3 id="Echoing-Sys-argv"><a href="#Echoing-Sys-argv">Echoing Sys.argv</a></h3>

<p>The default <code>Main.re</code> is very simple, and doesn&#39;t do anything with arguments.</p>
<pre class='rust'><code class='rust'>let run () =&gt; {
  print_endline &quot;Hello world&quot;;
};

let add2 x =&gt; x + 2;</code></pre>

<p>To start out let&#39;s just print out all received arguments:</p>
<pre class='rust'><code class='rust'>let run() =&gt; {
  print_endline (String.concat &quot;, &quot; (Array.to_list Sys.argv));
};</code></pre>

<blockquote><p>Docs for <code>Sys.argv</code> are <a href="">here</a></p>
</blockquote>

<p>Now, we rebuild with <code>make</code>, and this time we&#39;ll run the executable with some extra arguments:</p>
<pre class='bash'><code class='bash'>~$ jbuilder exec my_cli -- -an-argument another argument
my_cli, -an-argument, another, argument</code></pre>

<p><a href="https://caml.inria.fr/pub/docs/manual-ocaml/libref/Sys.html" target="_blank"><code>Sys.argv</code></a> is an <code>array</code> (fixed-length, mutable) of strings, starting with the name of the program. We wanted to display them, and the simplest way was to convert it to a list so that we could <code>String.concat</code> them all together into a single string.</p>
<h3 id="Reacting-to-arguments"><a href="#Reacting-to-arguments">Reacting to arguments</a></h3>

<p>Let&#39;s do something more intersting in response to arguments. If you run <code>my_cli beep</code> we&#39;ll respond with &quot;boop&quot;, and if you type <code>my_cli cowsay</code> followed by any text we&#39;ll mimic that beloved utility.</p>
<pre class='rust'><code class='rust'>let run() =&gt; {
  /**
   * Let&#39;s convert the args to a list again, as lists
   * are generally nicer to work with in Reason,
   * especially when we want to &quot;do something with the
   * first one, and then deal with the rest&quot;.
   * Arrays are better if we want mutation or random access.
   */
  let arglist = Array.to_list Sys.argv;
  switch arglist {
      /**
       * This initial &quot;_&quot; is a placeholder, meaning
       * &quot;we don&#39;t care what&#39;s first in the list&quot;.
       * Sys.argv&#39;s first item is the name of the
       * executable, which we don&#39;t care about.
       */
      | [_, &quot;beep&quot;] =&gt; print_endline &quot;boop&quot;
      | [_, &quot;cowsay&quot;, ...rest] =&gt; cowsay (String.concat &quot; &quot; rest)
      /**
       * This is the catchall case - any unrecognized
       * invocation will be met with our help text.
       */
      | _ =&gt; print_endline help_text;
  }
};</code></pre>

<p>Now what does cowsay look like? We&#39;ll do a simplified version that puts everything on one line.</p>
<pre class='rust'><code class='rust'>/* A multiline string! */
let cow = {|
        \   ^__^
         \  (oo)\_______
            (__)\       )\/\
                ||----w |
                ||     ||
|};
let cowsay text =&gt; {
  // `^` is the way to join strings together
  let message = &quot; ( &quot; ^ text ^ &quot; )&quot; ^ cow;
  // We could also do
  // Printf.printf &quot; ( %s ) %s&quot; text cow;
  print_endline message;
};</code></pre>

<blockquote><p>In OCaml, unlike rust, javascript, golang, java, etc., all declarations must go before usage, even at the top level. This means that we&#39;ll put <code>help_text</code> and <code>cowsay()</code> <em>above</em> our <code>run()</code> function in the final code.</p>
</blockquote>

<p>Come up with some helpful text, and we&#39;re all set!</p>
<pre class='bash'><code class='bash'>let help_text = {|my_cli - a cli for all your needs!

Usage:
 - my_cli beep
 - my_cli cowsay some text here
|};

let cow = {|
        \   ^__^
         \  (oo)\_______
            (__)\       )\/\
                ||----w |
                ||     ||
|};
let cowsay text =&gt; {
  let message = &quot; ( &quot; ^ text ^ &quot; )&quot; ^ cow;
  print_endline message;
};

let run() =&gt; {
  let arglist = Array.to_list Sys.argv;
  switch arglist {
      | [_, &quot;beep&quot;] =&gt; print_endline &quot;boop&quot;
      | [_, &quot;cowsay&quot;, ...rest] =&gt; cowsay (String.concat &quot; &quot; rest)
      | _ =&gt; print_endline help_text;
  }
};</code></pre>

<h2 id="We-39-re-done"><a href="#We-39-re-done">We&#39;re done!</a></h2>

<pre class='bash'><code class='bash'>~$ make
...
~$ ./_build/default/bin/my_cli.exe
my_cli - a cli for all your needs!

Usage:
 - my_cli beep
 - my_cli cowsay some text here

~$ ./_build/default/bin/my_cli.exe beep
boop
~$ ./_build/default/bin/my_cli.exe cowsay reason is awesome
 ( reason is awesome )
        \   ^__^
         \  (oo)\_______
            (__)\       )\/\
                ||----w |
                ||     ||</code></pre>

<h2 id="What-39-s-next"><a href="#What-39-s-next">What&#39;s next?</a></h2><p>The <a href="https://github.com/jaredly/ohai" target="_blank">source code</a> for <code>ohai</code> is pretty well documented, if you&#39;re interested in looking at something a little more complicated.</p>
<p>I&#39;m also planning on writing a tutorial on making a simple web server with <a href="https://github.com/mirage/ocaml-cohttp" target="_blank">cohttp</a> pretty soon.</p>
<p>Join us in our <a href="https://discord.gg/reasonml" target="_blank">Discord channel</a>, and catch me <a href="twitter.com/jaredforsyth">on twitter</a> with your comments!</p>

</div>
</article>
</main>
<div style="height: 128px"></div>
</div>
<div class="style-466863072" style="flex-basis: 100px; flex-shrink: 1"></div>
</div>
</body>
</html>